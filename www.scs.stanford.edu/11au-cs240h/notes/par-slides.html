<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"> 

<!-- Mirrored from www.scs.stanford.edu/11au-cs240h/notes/par-slides.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 19 Dec 2016 04:55:13 GMT -->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="pandoc" />
  <title>Folds and parallelism</title>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode, table.sourceCode pre 
   { margin: 0; padding: 0; border: 0; vertical-align: baseline; border: none; }
td.lineNumbers { border-right: 1px solid #AAAAAA; text-align: right; color: #AAAAAA; padding-right: 5px; padding-left: 5px; }
td.sourceCode { padding-left: 5px; }
code.sourceCode span.kw { color: #007020; font-weight: bold; } 
code.sourceCode span.dt { color: #902000; }
code.sourceCode span.dv { color: #40a070; }
code.sourceCode span.bn { color: #40a070; }
code.sourceCode span.fl { color: #40a070; }
code.sourceCode span.ch { color: #4070a0; }
code.sourceCode span.st { color: #4070a0; }
code.sourceCode span.co { color: #60a0b0; font-style: italic; }
code.sourceCode span.ot { color: #007020; }
code.sourceCode span.al { color: red; font-weight: bold; }
code.sourceCode span.fu { color: #06287e; }
code.sourceCode span.re { }
code.sourceCode span.er { color: red; font-weight: bold; }
  </style>
  <style type="text/css">
body{margin:0;padding:0;width:100%;height:100%;color:black;background-color:white;font-family:"Gill Sans MT","Gill Sans",GillSans,sans-serif;font-size:14pt;}.hidden{display:none;visibility:hidden;}div.toolbar{position:fixed;z-index:200;top:auto;bottom:0;left:0;right:0;height:1.2em;text-align:right;padding-left:1em;padding-right:1em;font-size:60%;color:red;background:#f0f0f0;}div.background{display:none;}div.handout{margin-left:20px;margin-right:20px;}div.slide.titlepage{text-align:center;}div.slide.titlepage.h1{padding-top:40%;}div.slide{z-index:20;margin:0;padding-top:0;padding-bottom:0;padding-left:20px;padding-right:20px;border-width:0;clear:both;top:0;bottom:0;left:0;right:0;line-height:120%;background-color:transparent;}div.slide+div[class].slide{page-break-before:always;}div.slide h1{padding-left:0;padding-right:20pt;padding-top:4pt;padding-bottom:4pt;margin-top:0;margin-left:0;margin-right:60pt;margin-bottom:.5em;display:block;font-size:160%;line-height:1.2em;background:transparent;}div.toc{position:absolute;top:auto;bottom:4em;left:4em;right:auto;width:60%;max-width:30em;height:30em;border:solid thin black;padding:1em;background:#f0f0f0;color:black;z-index:300;overflow:auto;display:block;visibility:visible;}div.toc-heading{width:100%;border-bottom:solid 1px #b4b4b4;margin-bottom:1em;text-align:center;}pre{font-size:80%;font-weight:bold;line-height:120%;padding-top:.2em;padding-bottom:.2em;padding-left:1em;padding-right:1em;border-style:solid;border-left-width:1em;border-top-width:thin;border-right-width:thin;border-bottom-width:thin;border-color:#95ABD0;color:#00428C;background-color:#E4E5E7;}li pre{margin-left:0;}@media print{div.slide{display:block;visibility:visible;position:relative;border-top-style:solid;border-top-width:thin;border-top-color:black;}div.slide pre{font-size:60%;padding-left:.5em;}div.handout{display:block;visibility:visible;}}blockquote{font-style:italic;}img{background-color:transparent;}p.copyright{font-size:smaller;}.center{text-align:center;}.footnote{font-size:smaller;margin-left:2em;}a img{border-width:0;border-style:none;}a:visited{color:navy;}a:link{color:navy;}a:hover{color:red;text-decoration:underline;}a:active{color:red;text-decoration:underline;}a{text-decoration:none;}.navbar a:link{color:white;}.navbar a:visited{color:yellow;}.navbar a:active{color:red;}.navbar a:hover{color:red;}ul{list-style-type:square;}ul ul{list-style-type:disc;}ul ul ul{list-style-type:circle;}ul ul ul ul{list-style-type:disc;}li{margin-left:.5em;margin-top:.5em;}li li{font-size:85%;font-style:italic;}li li li{font-size:85%;font-style:normal;}div dt{margin-left:0;margin-top:1em;margin-bottom:.5em;font-weight:bold;}div dd{margin-left:2em;margin-bottom:.5em;}p,pre,ul,ol,blockquote,h2,h3,h4,h5,h6,dl,table{margin-left:1em;margin-right:1em;}p.subhead{font-weight:bold;margin-top:2em;}.smaller{font-size:smaller;}.bigger{font-size:130%;}td,th{padding:.2em;}ul{margin:.5em 1.5em .5em 1.5em;padding:0;}ol{margin:.5em 1.5em .5em 1.5em;padding:0;}ul{list-style-type:square;}ul ul{list-style-type:disc;}ul ul ul{list-style-type:circle;}ul ul ul ul{list-style-type:disc;}ul li{list-style:square;margin:.1em 0 .6em 0;padding:0;line-height:140%;}ol li{margin:.1em 0 .6em 1.5em;padding:0;line-height:140%;list-style-type:decimal;}li ul li{font-size:85%;font-style:italic;list-style-type:disc;background:transparent;padding:0;}li li ul li{font-size:85%;font-style:normal;list-style-type:circle;background:transparent;padding:0;}li li li ul li{list-style-type:disc;background:transparent;padding:0;}li ol li{list-style-type:decimal;}li li ol li{list-style-type:decimal;}ol.outline li:hover{cursor:pointer;}ol.outline li.nofold:hover{cursor:default;}ul.outline li:hover{cursor:pointer;}ul.outline li.nofold:hover{cursor:default;}ol.outline{list-style:decimal;}ol.outline ol{list-style-type:lower-alpha;}ol.outline li.nofold{padding:0 0 0 20px;background:transparent url(http://www.scs.stanford.edu/11au-cs240h/notes/nofold-dim.gif) no-repeat 0 .5em;}ol.outline li.unfolded{padding:0 0 0 20px;background:transparent url(http://www.scs.stanford.edu/11au-cs240h/notes/fold-dim.gif) no-repeat 0 .5em;}ol.outline li.folded{padding:0 0 0 20px;background:transparent url(http://www.scs.stanford.edu/11au-cs240h/notes/unfold-dim.gif) no-repeat 0 .5em;}ol.outline li.unfolded:hover{padding:0 0 0 20px;background:transparent url(http://www.scs.stanford.edu/11au-cs240h/notes/fold.gif) no-repeat 0 .5em;}ol.outline li.folded:hover{padding:0 0 0 20px;background:transparent url(http://www.scs.stanford.edu/11au-cs240h/notes/unfold.gif) no-repeat 0 .5em;}ul.outline li.nofold{padding:0 0 0 20px;background:transparent url(http://www.scs.stanford.edu/11au-cs240h/notes/nofold-dim.gif) no-repeat 0 .5em;}ul.outline li.unfolded{padding:0 0 0 20px;background:transparent url(http://www.scs.stanford.edu/11au-cs240h/notes/fold-dim.gif) no-repeat 0 .5em;}ul.outline li.folded{padding:0 0 0 20px;background:transparent url(http://www.scs.stanford.edu/11au-cs240h/notes/unfold-dim.gif) no-repeat 0 .5em;}ul.outline li.unfolded:hover{padding:0 0 0 20px;background:transparent url(http://www.scs.stanford.edu/11au-cs240h/notes/fold.gif) no-repeat 0 .5em;}ul.outline li.folded:hover{padding:0 0 0 20px;background:transparent url(http://www.scs.stanford.edu/11au-cs240h/notes/unfold.gif) no-repeat 0 .5em;}a.titleslide{font-weight:bold;font-style:italic;}
  </style>
  <script type="text/javascript" charset="utf-8">
var w3c_slidy={ns_pos:(typeof window.pageYOffset!="undefined"),khtml:((navigator.userAgent).indexOf("KHTML")>=0?true:false),opera:((navigator.userAgent).indexOf("Opera")>=0?true:false),ipad:((navigator.userAgent).indexOf("iPad")>=0?true:false),iphone:((navigator.userAgent).indexOf("iPhone")>=0?true:false),ie:(typeof document.all!="undefined"&&!this.opera),ie6:(!this.ns_pos&&navigator.userAgent.indexOf("MSIE 6")!=-1),ie7:(!this.ns_pos&&navigator.userAgent.indexOf("MSIE 7")!=-1),ie8:(!this.ns_pos&&navigator.userAgent.indexOf("MSIE 8")!=-1),ie9:(!this.ns_pos&&navigator.userAgent.indexOf("MSIE 9")!=-1),keyboardless:(this.ipad||this.iphone),is_xhtml:/xml/.test(document.contentType),slide_number:0,slide_number_element:null,slides:[],notes:[],backgrounds:[],toolbar:null,title:null,last_shown:null,eos:null,toc:null,outline:null,selected_text_len:0,view_all:0,want_toolbar:true,mouse_click_enabled:true,scroll_hack:0,disable_slide_click:false,lang:"en",help_anchor:null,help_page:"http://www.w3.org/Talks/Tools/Slidy2/help/help.html",help_text:"Navigate with mouse click, space bar, Cursor Left/Right, or Pg Up and Pg Dn. Use S and B to change font size.",size_index:0,size_adjustment:0,sizes:new Array("10pt","12pt","14pt","16pt","18pt","20pt","22pt","24pt","26pt","28pt","30pt","32pt"),last_width:0,last_height:0,objects:[],set_up:function(){var a=function(){w3c_slidy.init()};if(typeof window.addEventListener!="undefined"){window.addEventListener("load",a,false)}else{window.attachEvent("onload",a)}},hide_slides:function(){if(document.body&&!w3c_slidy.initialized){document.body.style.visibility="hidden"}else{setTimeout(w3c_slidy.hide_slides,50)}},ie_hack:function(){window.resizeBy(0,-1);window.resizeBy(0,1)},init:function(){document.body.style.visibility="visible";this.init_localization();this.add_toolbar();this.wrap_implicit_slides();this.collect_slides();this.collect_notes();this.collect_backgrounds();this.objects=document.body.getElementsByTagName("object");this.patch_anchors();this.slide_number=this.find_slide_number(location.href);window.offscreenbuffering=true;this.size_adjustment=this.find_size_adjust();this.time_left=this.find_duration();this.hide_image_toolbar();this.init_outliner();this.title=document.title;this.is_xhtml=(document.body.tagName=="BODY"?false:true);if(this.slides.length>0){var a=this.slides[this.slide_number];if(this.slide_number>0){this.set_visibility_all_incremental("visible");this.last_shown=this.previous_incremental_item(null);this.set_eos_status(true)}else{this.last_shown=null;this.set_visibility_all_incremental("hidden");this.set_eos_status(!this.next_incremental_item(this.last_shown))}this.set_location();this.add_class(this.slides[0],"first-slide");w3c_slidy.show_slide(a)}this.toc=this.table_of_contents();this.add_initial_prompt();if(!this.keyboardless){this.add_listener(document.body,"click",this.mouse_button_click)}this.add_listener(document,"keydown",this.key_down);this.add_listener(document,"keypress",this.key_press);this.add_listener(window,"resize",this.resized);this.add_listener(window,"scroll",this.scrolled);this.add_listener(window,"unload",this.unloaded);this.single_slide_view();this.resized();if(this.ie7){setTimeout(w3c_slidy.ie_hack,100)}this.show_toolbar();setInterval(function(){w3c_slidy.check_location()},200);w3c_slidy.initialized=true},table_of_contents:function(){var c=this.create_element("div");this.add_class(c,"slidy_toc hidden");var k=this.create_element("div");this.add_class(k,"toc-heading");k.innerHTML=this.localize("Table of Contents");c.appendChild(k);var f=null;for(var d=0;d<this.slides.length;++d){var g=this.has_class(this.slides[d],"title");var e=document.createTextNode((d+1)+". ");c.appendChild(e);var h=this.create_element("a");h.setAttribute("href","#("+(d+1)+")");if(g){this.add_class(h,"titleslide")}var b=document.createTextNode(this.slide_name(d));h.appendChild(b);h.onclick=w3c_slidy.toc_click;h.onkeydown=w3c_slidy.toc_key_down;h.previous=f;if(f){f.next=h}c.appendChild(h);if(d==0){c.first=h}if(d<this.slides.length-1){var j=this.create_element("br");c.appendChild(j)}f=h}c.focus=function(){if(this.first){this.first.focus()}};c.onmouseup=w3c_slidy.mouse_button_up;c.onclick=function(a){a||(a=window.event);if(w3c_slidy.selected_text_len<=0){w3c_slidy.hide_table_of_contents(true)}w3c_slidy.stop_propagation(a);if(a.cancel!=undefined){a.cancel=true}if(a.returnValue!=undefined){a.returnValue=false}return false};document.body.insertBefore(c,document.body.firstChild);return c},is_shown_toc:function(){return !w3c_slidy.has_class(w3c_slidy.toc,"hidden")},show_table_of_contents:function(){w3c_slidy.remove_class(w3c_slidy.toc,"hidden");var a=w3c_slidy.toc;a.focus();if(w3c_slidy.ie7&&w3c_slidy.slide_number==0){setTimeout(w3c_slidy.ie_hack,100)}},hide_table_of_contents:function(a){w3c_slidy.add_class(w3c_slidy.toc,"hidden");if(a&&!w3c_slidy.opera){w3c_slidy.help_anchor.focus()}},toggle_table_of_contents:function(){if(w3c_slidy.is_shown_toc()){w3c_slidy.hide_table_of_contents(true)}else{w3c_slidy.show_table_of_contents()}},toc_click:function(d){if(!d){d=window.event}var c=w3c_slidy.get_target(d);if(c&&c.nodeType==1){var b=c.getAttribute("href");if(b){var a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.hide_slide(a);w3c_slidy.slide_number=w3c_slidy.find_slide_number(b);a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.last_shown=null;w3c_slidy.set_location();w3c_slidy.set_visibility_all_incremental("hidden");w3c_slidy.set_eos_status(!w3c_slidy.next_incremental_item(w3c_slidy.last_shown));w3c_slidy.show_slide(a);try{if(!w3c_slidy.opera){w3c_slidy.help_anchor.focus()}}catch(d){}}}w3c_slidy.hide_table_of_contents(true);if(w3c_slidy.ie7){w3c_slidy.ie_hack()}w3c_slidy.stop_propagation(d);return w3c_slidy.cancel(d)},toc_key_down:function(d){var b;if(!d){var d=window.event}if(window.event){b=window.event.keyCode}else{if(d.which){b=d.which}else{return true}}if(!b){return true}if(d.ctrlKey||d.altKey){return true}if(b==13){var c=this.getAttribute("href");if(c){var a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.hide_slide(a);w3c_slidy.slide_number=w3c_slidy.find_slide_number(c);a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.last_shown=null;w3c_slidy.set_location();w3c_slidy.set_visibility_all_incremental("hidden");w3c_slidy.set_eos_status(!w3c_slidy.next_incremental_item(w3c_slidy.last_shown));w3c_slidy.show_slide(a);try{if(!w3c_slidy.opera){w3c_slidy.help_anchor.focus()}}catch(f){}}w3c_slidy.hide_table_of_contents(true);if(self.ie7){w3c_slidy.ie_hack()}return w3c_slidy.cancel(d)}if(b==40&&this.next){this.next.focus();return w3c_slidy.cancel(d)}if(b==38&&this.previous){this.previous.focus();return w3c_slidy.cancel(d)}return true},before_print:function(){this.show_all_slides();this.hide_toolbar();alert("before print")},after_print:function(){if(!this.view_all){this.single_slide_view();this.show_toolbar()}alert("after print")},print_slides:function(){this.before_print();window.print();this.after_print()},toggle_view:function(){if(this.view_all){this.single_slide_view();this.show_toolbar();this.view_all=0}else{this.show_all_slides();this.hide_toolbar();this.view_all=1}},show_all_slides:function(){this.remove_class(document.body,"single_slide");this.set_visibility_all_incremental("visible")},single_slide_view:function(){this.add_class(document.body,"single_slide");this.set_visibility_all_incremental("visible");this.last_shown=this.previous_incremental_item(null)},hide_image_toolbar:function(){if(!this.ns_pos){var a=document.getElementsByTagName("IMG");for(var b=0;b<a.length;++b){a[b].setAttribute("galleryimg","no")}}},unloaded:function(a){},is_KHTML:function(){var a=navigator.userAgent;return(a.indexOf("KHTML")>=0?true:false)},slide_name:function(c){var b=null;var a=this.slides[c];var d=this.find_heading(a);if(d){b=this.extract_text(d)}if(!b){b=this.title+"("+(c+1)+")"}b.replace(/\&/g,"&amp;");b.replace(/\</g,"&lt;");b.replace(/\>/g,"&gt;");return b},find_heading:function(a){if(!a||a.nodeType!=1){return null}if(a.nodeName=="H1"||a.nodeName=="h1"){return a}var b=a.firstChild;while(b){a=this.find_heading(b);if(a){return a}b=b.nextSibling}return null},extract_text:function(a){if(!a){return""}if(a.nodeType==3){return a.nodeValue}if(a.nodeType==1){a=a.firstChild;var b="";while(a){b=b+this.extract_text(a);a=a.nextSibling}return b}return""},find_copyright:function(){var a,c;var d=document.getElementsByTagName("meta");for(var b=0;b<d.length;++b){a=d[b].getAttribute("name");c=d[b].getAttribute("content");if(a=="copyright"){return c}}return null},find_size_adjust:function(){var a,c,e;var d=document.getElementsByTagName("meta");for(var b=0;b<d.length;++b){a=d[b].getAttribute("name");c=d[b].getAttribute("content");if(a=="font-size-adjustment"){return 1*c}}return 1},find_duration:function(){var a,c,e;var d=document.getElementsByTagName("meta");for(var b=0;b<d.length;++b){a=d[b].getAttribute("name");c=d[b].getAttribute("content");if(a=="duration"){return 60000*c}}return null},replace_by_non_breaking_space:function(b){for(var a=0;a<b.length;++a){b[a]=160}},init_outliner:function(){var a=document.getElementsByTagName("li");for(var b=0;b<a.length;++b){var c=a[b];if(!this.has_class(c.parentNode,"outline")){continue}c.onclick=this.outline_click;if(this.foldable(c)){c.foldable=true;c.onfocus=function(){w3c_slidy.outline=this};c.onblur=function(){w3c_slidy.outline=null};if(!c.getAttribute("tabindex")){c.setAttribute("tabindex","0")}if(this.has_class(c,"expand")){this.unfold(c)}else{this.fold(c)}}else{this.add_class(c,"nofold");c.visible=true;c.foldable=false}}},foldable:function(b){if(!b||b.nodeType!=1){return false}var a=b.firstChild;while(a){if(a.nodeType==1&&this.is_block(a)){return true}a=a.nextSibling}return false},fold:function(b){if(b){this.remove_class(b,"unfolded");this.add_class(b,"folded")}var a=b?b.firstChild:null;while(a){if(a.nodeType==1&&this.is_block(a)){w3c_slidy.add_class(a,"hidden")}a=a.nextSibling}b.visible=false},unfold:function(b){if(b){this.add_class(b,"unfolded");this.remove_class(b,"folded")}var a=b?b.firstChild:null;while(a){if(a.nodeType==1&&this.is_block(a)){w3c_slidy.remove_class(a,"hidden")}a=a.nextSibling}b.visible=true},outline_click:function(c){if(!c){c=window.event}var a=false;var b=w3c_slidy.get_target(c);while(b&&b.visible==undefined){b=b.parentNode}if(!b){return true}if(c.which){a=(c.which==3)}else{if(c.button){a=(c.button==2)}}if(!a&&b.visible!=undefined){if(b.foldable){if(b.visible){w3c_slidy.fold(b)}else{w3c_slidy.unfold(b)}}w3c_slidy.stop_propagation(c);c.cancel=true;c.returnValue=false}return false},add_initial_prompt:function(){var a=this.create_element("div");a.setAttribute("class","initial_prompt");var b=this.create_element("p");a.appendChild(b);b.setAttribute("class","help");if(this.keyboardless){b.innerHTML="Tap footer to move to next slide"}else{b.innerHTML="Space or Right Arrow to move to next slide, click help below for more details"}this.add_listener(a,"click",function(c){document.body.removeChild(a);w3c_slidy.stop_propagation(c);if(c.cancel!=undefined){c.cancel=true}if(c.returnValue!=undefined){c.returnValue=false}return false});document.body.appendChild(a);this.initial_prompt=a;setTimeout(function(){document.body.removeChild(a)},5000)},add_toolbar:function(){var a,i;this.toolbar=this.create_element("div");this.toolbar.setAttribute("class","toolbar");if(this.ns_pos||!this.ie6){var k=this.create_element("div");k.setAttribute("style","float: right; text-align: right");a=this.create_element("span");a.innerHTML=this.localize("slide")+" n/m";k.appendChild(a);this.toolbar.appendChild(k);var e=this.create_element("div");e.setAttribute("style","text-align: left");this.eos=this.create_element("span");this.eos.innerHTML="* ";e.appendChild(this.eos);var g=this.create_element("a");g.setAttribute("href",this.help_page);g.setAttribute("title",this.localize(this.help_text));g.innerHTML=this.localize("help?");e.appendChild(g);this.help_anchor=g;var d=document.createTextNode(" ");e.appendChild(d);var f=this.create_element("a");f.setAttribute("href","javascript:w3c_slidy.toggle_table_of_contents()");f.setAttribute("title",this.localize("table of contents"));f.innerHTML=this.localize("contents?");e.appendChild(f);var b=document.createTextNode(" ");e.appendChild(b);var h=this.find_copyright();if(h){var j=this.create_element("span");j.className="copyright";j.innerHTML=h;e.appendChild(j)}this.toolbar.setAttribute("tabindex","0");this.toolbar.appendChild(e)}else{this.toolbar.style.position=(this.ie7?"fixed":"absolute");this.toolbar.style.zIndex="200";this.toolbar.style.width="99.9%";this.toolbar.style.height="1.2em";this.toolbar.style.top="auto";this.toolbar.style.bottom="0";this.toolbar.style.left="0";this.toolbar.style.right="0";this.toolbar.style.textAlign="left";this.toolbar.style.fontSize="60%";this.toolbar.style.color="red";this.toolbar.borderWidth=0;this.toolbar.className="toolbar";this.toolbar.style.background="rgb(240,240,240)";var c=this.create_element("span");c.innerHTML="&nbsp;&nbsp;*&nbsp;";this.toolbar.appendChild(c);this.eos=c;var g=this.create_element("a");g.setAttribute("href",this.help_page);g.setAttribute("title",this.localize(this.help_text));g.innerHTML=this.localize("help?");this.toolbar.appendChild(g);this.help_anchor=g;var d=document.createTextNode(" ");this.toolbar.appendChild(d);var f=this.create_element("a");f.setAttribute("href","javascript:toggleTableOfContents()");f.setAttribute("title",this.localize("table of contents".localize));f.innerHTML=this.localize("contents?");this.toolbar.appendChild(f);var b=document.createTextNode(" ");this.toolbar.appendChild(b);var h=this.find_copyright();if(h){var j=this.create_element("span");j.innerHTML=h;j.style.color="black";j.style.marginLeft="0.5em";this.toolbar.appendChild(j)}a=this.create_element("div");a.style.position="absolute";a.style.width="auto";a.style.height="1.2em";a.style.top="auto";a.style.bottom=0;a.style.right="0";a.style.textAlign="right";a.style.color="red";a.style.background="rgb(240,240,240)";a.innerHTML=this.localize("slide")+" n/m";this.toolbar.appendChild(a)}this.toolbar.onclick=function(m){if(!m){m=window.event}var l=m.target;if(!l&&m.srcElement){l=m.srcElement}if(l&&l.nodeType==3){l=l.parentNode}w3c_slidy.stop_propagation(m);if(l&&l.nodeName.toLowerCase()!="a"){w3c_slidy.mouse_button_click(m)}};this.slide_number_element=a;this.set_eos_status(false);document.body.appendChild(this.toolbar)},wrap_implicit_slides:function(){var a,d,c,b,f;var e=document.getElementsByTagName("h1");if(!e){return}for(a=0;a<e.length;++a){d=e[a];if(d.parentNode!=document.body){continue}c=d.nextSibling;f=document.createElement("div");this.add_class(f,"slide");document.body.replaceChild(f,d);f.appendChild(d);while(c){if(c.nodeType==1&&(c.nodeName=="H1"||c.nodeName=="h1"||c.nodeName=="DIV"||c.nodeName=="div")){break}b=c.nextSibling;c=document.body.removeChild(c);f.appendChild(c);c=b}}},collect_slides:function(){var e=new Array();var d=document.body.getElementsByTagName("div");for(var c=0;c<d.length;++c){div=d.item(c);if(this.has_class(div,"slide")){e[e.length]=div;this.add_class(div,"hidden");var b=document.createElement("br");div.appendChild(b);var a=document.createElement("br");div.appendChild(a)}else{if(this.has_class(div,"background")){div.style.display="block"}}}this.slides=e},collect_notes:function(){var b=new Array();var c=document.body.getElementsByTagName("div");for(var a=0;a<c.length;++a){div=c.item(a);if(this.has_class(div,"handout")){b[b.length]=div;this.add_class(div,"hidden")}}this.notes=b},collect_backgrounds:function(){var c=new Array();var b=document.body.getElementsByTagName("div");for(var a=0;a<b.length;++a){div=b.item(a);if(this.has_class(div,"background")){c[c.length]=div;this.add_class(div,"hidden")}}this.backgrounds=c},patch_anchors:function(){var a=w3c_slidy;var c=function(g){if(a.page_address(this.href)==a.page_address(location.href)){var f=a.find_slide_number(this.href);if(f!=a.slide_number){var e=a.slides[a.slide_number];a.hide_slide(e);a.slide_number=f;e=a.slides[a.slide_number];a.show_slide(e);a.set_location()}}else{w3c_slidy.stop_propagation(g)}this.blur();a.disable_slide_click=true};var d=document.body.getElementsByTagName("a");for(var b=0;b<d.length;++b){if(window.addEventListener){d[b].addEventListener("click",c,false)}else{d[b].attachEvent("onclick",c)}}},show_slide_number:function(){var a=w3c_slidy.get_timer();w3c_slidy.slide_number_element.innerHTML=a+w3c_slidy.localize("slide")+" "+(w3c_slidy.slide_number+1)+"/"+w3c_slidy.slides.length},check_location:function(){var b=location.hash;if(w3c_slidy.slide_number>0&&(b==""||b=="#")){w3c_slidy.goto_slide(0)}else{if(b.length>2&&b!="#("+(w3c_slidy.slide_number+1)+")"){var a=parseInt(location.hash.substr(2));if(!isNaN(a)){w3c_slidy.goto_slide(a-1)}}}if(w3c_slidy.time_left&&w3c_slidy.slide_number>0){w3c_slidy.show_slide_number();if(w3c_slidy.time_left>0){w3c_slidy.time_left-=200}}},get_timer:function(){var c="";if(w3c_slidy.time_left){var b,a;a=Math.floor(w3c_slidy.time_left/1000);b=Math.floor(a/60);a=a%60;c=(b?b+"m":"")+a+"s "}return c},set_location:function(){var a=w3c_slidy.page_address(location.href);var b="#("+(w3c_slidy.slide_number+1)+")";if(w3c_slidy.slide_number>=0){a=a+b}if(w3c_slidy.ie&&(w3c_slidy.ie6||w3c_slidy.ie7)){w3c_slidy.push_hash(b)}if(a!=location.href){location.href=a}if(this.khtml){b="("+(w3c_slidy.slide_number+1)+")"}if(!this.ie&&location.hash!=b&&location.hash!=""){location.hash=b}document.title=w3c_slidy.title+" ("+(w3c_slidy.slide_number+1)+")";w3c_slidy.show_slide_number()},page_address:function(b){var a=b.indexOf("#");if(a<0){a=b.indexOf("%23")}if(a<0){return b}return b.substr(0,a)},on_frame_loaded:function(b){location.hash=b;var a=w3c_slidy.page_address(location.href);location.href=a+b},push_hash:function(b){if(b==""){b="#(1)"}window.location.hash=b;var a=document.getElementById("historyFrame").contentWindow.document;a.open("javascript:'<html></html>'");a.write('<html><head><script type="text/javascript">window.parent.w3c_slidy.on_frame_loaded(\''+(b)+"');\74/script></head><body>hello mum</body></html>");a.close()},find_slide_number:function(e){var c=e.indexOf("#");if(c<0){return 0}var b=unescape(e.substr(c+1));var f=document.getElementById(b);if(!f){var d=/\((\d)+\)/;if(b.match(d)){var a=parseInt(b.substring(1,b.length-1));if(a>this.slides.length){a=1}if(--a<0){a=0}return a}d=/\[(\d)+\]/;if(b.match(d)){var a=parseInt(b.substring(1,b.length-1));if(a>this.slides.length){a=1}if(--a<0){a=0}return a}return 0}while(true){if(f.nodeName.toLowerCase()=="div"&&this.has_class(f,"slide")){break}f=f.parentNode;if(!f){return 0}}for(c=0;c<slides.length;++c){if(slides[c]==f){return c}}return 0},previous_slide:function(b){if(!w3c_slidy.view_all){var a;if((b||w3c_slidy.slide_number==0)&&w3c_slidy.last_shown!=null){w3c_slidy.last_shown=w3c_slidy.hide_previous_item(w3c_slidy.last_shown);w3c_slidy.set_eos_status(false)}else{if(w3c_slidy.slide_number>0){a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.hide_slide(a);w3c_slidy.slide_number=w3c_slidy.slide_number-1;a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.set_visibility_all_incremental("visible");w3c_slidy.last_shown=w3c_slidy.previous_incremental_item(null);w3c_slidy.set_eos_status(true);w3c_slidy.show_slide(a)}}w3c_slidy.set_location();if(!w3c_slidy.ns_pos){w3c_slidy.refresh_toolbar(200)}}},next_slide:function(c){if(!w3c_slidy.view_all){var a,b=w3c_slidy.last_shown;if(c||w3c_slidy.slide_number==w3c_slidy.slides.length-1){w3c_slidy.last_shown=w3c_slidy.reveal_next_item(w3c_slidy.last_shown)}if((!c||w3c_slidy.last_shown==null)&&w3c_slidy.slide_number<w3c_slidy.slides.length-1){a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.hide_slide(a);w3c_slidy.slide_number=w3c_slidy.slide_number+1;a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.last_shown=null;w3c_slidy.set_visibility_all_incremental("hidden");w3c_slidy.show_slide(a)}else{if(!w3c_slidy.last_shown){if(b&&c){w3c_slidy.last_shown=b}}}w3c_slidy.set_location();w3c_slidy.set_eos_status(!w3c_slidy.next_incremental_item(w3c_slidy.last_shown));if(!w3c_slidy.ns_pos){w3c_slidy.refresh_toolbar(200)}}},first_slide:function(){if(!w3c_slidy.view_all){var a;if(w3c_slidy.slide_number!=0){a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.hide_slide(a);w3c_slidy.slide_number=0;a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.last_shown=null;w3c_slidy.set_visibility_all_incremental("hidden");w3c_slidy.show_slide(a)}w3c_slidy.set_eos_status(!w3c_slidy.next_incremental_item(w3c_slidy.last_shown));w3c_slidy.set_location()}},last_slide:function(){if(!w3c_slidy.view_all){var a;w3c_slidy.last_shown=null;if(w3c_slidy.last_shown==null&&w3c_slidy.slide_number<w3c_slidy.slides.length-1){a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.hide_slide(a);w3c_slidy.slide_number=w3c_slidy.slides.length-1;a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.set_visibility_all_incremental("visible");w3c_slidy.last_shown=w3c_slidy.previous_incremental_item(null);w3c_slidy.show_slide(a)}else{w3c_slidy.set_visibility_all_incremental("visible");w3c_slidy.last_shown=w3c_slidy.previous_incremental_item(null)}w3c_slidy.set_eos_status(true);w3c_slidy.set_location()}},set_eos_status:function(a){if(this.eos){this.eos.style.color=(a?"rgb(240,240,240)":"red")}},goto_slide:function(b){var a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.hide_slide(a);w3c_slidy.slide_number=b;a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.last_shown=null;w3c_slidy.set_visibility_all_incremental("hidden");w3c_slidy.set_eos_status(!w3c_slidy.next_incremental_item(w3c_slidy.last_shown));document.title=w3c_slidy.title+" ("+(w3c_slidy.slide_number+1)+")";w3c_slidy.show_slide(a);w3c_slidy.show_slide_number()},show_slide:function(a){this.sync_background(a);window.scrollTo(0,0);this.remove_class(a,"hidden")},hide_slide:function(a){this.add_class(a,"hidden")},sync_background:function(a){var e;var g;if(a.currentStyle){g=a.currentStyle.backgroundColor}else{if(document.defaultView){var f=document.defaultView.getComputedStyle(a,null);if(f){g=f.getPropertyValue("background-color")}else{g="transparent"}}else{g=="transparent"}}if(g=="transparent"||g.indexOf("rgba")>=0||g.indexOf("opacity")>=0){var c=this.get_class_list(a);for(var d=0;d<this.backgrounds.length;d++){e=this.backgrounds[d];var b=this.get_class_list(e);if(this.matching_background(c,b)){this.remove_class(e,"hidden")}else{this.add_class(e,"hidden")}}}else{this.hide_backgrounds()}},hide_backgrounds:function(){for(var a=0;a<this.backgrounds.length;a++){background=this.backgrounds[a];this.add_class(background,"hidden")}},matching_background:function(c,b){var d,e,f,a;f=/\w+/g;a=b.match(f);for(d=e=0;d<a.length;d++){if(a[d]=="hidden"){continue}if(a[d]=="background"){continue}++e}if(e==0){return true}a=c.match(f);for(d=e=0;d<a.length;d++){if(a[d]=="hidden"){continue}if(this.has_token(b,a[d])){return true}}return false},resized:function(){var c=0;if(typeof(window.innerWidth)=="number"){c=window.innerWidth}else{if(document.documentElement&&document.documentElement.clientWidth){c=document.documentElement.clientWidth}else{if(document.body&&document.body.clientWidth){c=document.body.clientWidth}}}var b=0;if(typeof(window.innerHeight)=="number"){b=window.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){b=document.documentElement.clientHeight}else{if(document.body&&document.body.clientHeight){b=document.body.clientHeight}}}if(b&&(c/b>1.05*1024/768)){c=b*1024/768}if(c!=w3c_slidy.last_width||b!=w3c_slidy.last_height){if(c>=1100){w3c_slidy.size_index=5}else{if(c>=1000){w3c_slidy.size_index=4}else{if(c>=800){w3c_slidy.size_index=3}else{if(c>=600){w3c_slidy.size_index=2}else{if(c){w3c_slidy.size_index=0}}}}}if(0<=w3c_slidy.size_index+w3c_slidy.size_adjustment&&w3c_slidy.size_index+w3c_slidy.size_adjustment<w3c_slidy.sizes.length){w3c_slidy.size_index=w3c_slidy.size_index+w3c_slidy.size_adjustment}w3c_slidy.adjust_object_dimensions(c,b);if(document.body.style.fontSize!=w3c_slidy.sizes[w3c_slidy.size_index]){document.body.style.fontSize=w3c_slidy.sizes[w3c_slidy.size_index]}w3c_slidy.last_width=c;w3c_slidy.last_height=b;if(w3c_slidy.ns_pos){var a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.hide_slide(a);w3c_slidy.show_slide(a)}w3c_slidy.refresh_toolbar(200)}},scrolled:function(){if(w3c_slidy.toolbar&&!w3c_slidy.ns_pos&&!w3c_slidy.ie7){w3c_slidy.hack_offset=w3c_slidy.scroll_x_offset();w3c_slidy.toolbar.style.display="none";if(w3c_slidy.scrollhack==0&&!w3c_slidy.view_all){setTimeout(function(){w3c_slidy.show_toolbar()},1000);w3c_slidy.scrollhack=1}}},hide_toolbar:function(){w3c_slidy.add_class(w3c_slidy.toolbar,"hidden");window.focus()},refresh_toolbar:function(a){if(!w3c_slidy.ns_pos&&!w3c_slidy.ie7){w3c_slidy.hide_toolbar();setTimeout(function(){w3c_slidy.show_toolbar()},a)}},show_toolbar:function(){if(w3c_slidy.want_toolbar){w3c_slidy.toolbar.style.display="block";if(!w3c_slidy.ns_pos){var b=w3c_slidy.scroll_x_offset();w3c_slidy.toolbar.style.left=b;w3c_slidy.toolbar.style.right=b;w3c_slidy.toolbar.style.bottom=0}w3c_slidy.remove_class(w3c_slidy.toolbar,"hidden")}w3c_slidy.scrollhack=0;try{if(!w3c_slidy.opera){w3c_slidy.help_anchor.focus()}}catch(a){}},toggle_toolbar:function(){if(!w3c_slidy.view_all){if(w3c_slidy.has_class(w3c_slidy.toolbar,"hidden")){w3c_slidy.remove_class(w3c_slidy.toolbar,"hidden");w3c_slidy.want_toolbar=1}else{w3c_slidy.add_class(w3c_slidy.toolbar,"hidden");w3c_slidy.want_toolbar=0}}},scroll_x_offset:function(){if(window.pageXOffset){return self.pageXOffset}if(document.documentElement&&document.documentElement.scrollLeft){return document.documentElement.scrollLeft}if(document.body){return document.body.scrollLeft}return 0},scroll_y_offset:function(){if(window.pageYOffset){return self.pageYOffset}if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollTop}if(document.body){return document.body.scrollTop}return 0},optimize_font_size:function(){var a=w3c_slidy.slides[w3c_slidy.slide_number];var d=a.scrollHeight;var b=getWindowHeight();var c=100*d/b;alert("window utilization = "+c+"% (doc "+d+" win "+b+")")},get_doc_height:function(a){if(!a){a=document}if(a&&a.body&&a.body.offsetHeight){return a.body.offsetHeight}if(a&&a.body&&a.body.scrollHeight){return a.body.scrollHeight}alert("couldn't determine document height")},get_window_height:function(){if(typeof(window.innerHeight)=="number"){return window.innerHeight}if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight}if(document.body&&document.body.clientHeight){return document.body.clientHeight}},document_height:function(){var a,b;a=document.body.scrollHeight;b=document.body.offsetHeight;if(a&&b){return(a>b?a:b)}return 0},smaller:function(){if(w3c_slidy.size_index>0){--w3c_slidy.size_index}w3c_slidy.toolbar.style.display="none";document.body.style.fontSize=w3c_slidy.sizes[w3c_slidy.size_index];var a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.hide_slide(a);w3c_slidy.show_slide(a);setTimeout(function(){w3c_slidy.show_toolbar()},50)},bigger:function(){if(w3c_slidy.size_index<w3c_slidy.sizes.length-1){++w3c_slidy.size_index}w3c_slidy.toolbar.style.display="none";document.body.style.fontSize=w3c_slidy.sizes[w3c_slidy.size_index];var a=w3c_slidy.slides[w3c_slidy.slide_number];w3c_slidy.hide_slide(a);w3c_slidy.show_slide(a);setTimeout(function(){w3c_slidy.show_toolbar()},50)},adjust_object_dimensions:function(c,k){for(var e=0;e<w3c_slidy.objects.length;e++){var d=this.objects[e];var b=d.getAttribute("type");if(b=="image/svg+xml"||b=="application/x-shockwave-flash"){if(!d.initialWidth){d.initialWidth=d.getAttribute("width")}if(!d.initialHeight){d.initialHeight=d.getAttribute("height")}if(d.initialWidth&&d.initialWidth.charAt(d.initialWidth.length-1)=="%"){var j=parseInt(d.initialWidth.slice(0,d.initialWidth.length-1));var a=c*(j/100);d.setAttribute("width",a)}if(d.initialHeight&&d.initialHeight.charAt(d.initialHeight.length-1)=="%"){var f=parseInt(d.initialHeight.slice(0,d.initialHeight.length-1));var g=k*(f/100);d.setAttribute("height",g)}}}},key_press:function(a){if(!a){a=window.event}if(!w3c_slidy.key_wanted){return w3c_slidy.cancel(a)}return true},key_down:function(d){var c,e,a;w3c_slidy.key_wanted=true;if(!d){d=window.event}if(window.event){c=window.event.keyCode;e=window.event.srcElement}else{if(d.which){c=d.which;e=d.target}else{return true}}if(!c){return true}if(!w3c_slidy.slidy_chrome(e)&&w3c_slidy.special_element(e)){return true}if(d.ctrlKey||d.altKey||d.metaKey){return true}if(w3c_slidy.is_shown_toc()&&c!=9&&c!=16&&c!=38&&c!=40){w3c_slidy.hide_table_of_contents(true);if(c==27||c==84||c==67){return w3c_slidy.cancel(d)}}if(c==34){if(w3c_slidy.view_all){return true}w3c_slidy.next_slide(false);return w3c_slidy.cancel(d)}else{if(c==33){if(w3c_slidy.view_all){return true}w3c_slidy.previous_slide(false);return w3c_slidy.cancel(d)}else{if(c==32){w3c_slidy.next_slide(true);return w3c_slidy.cancel(d)}else{if(c==37){w3c_slidy.previous_slide(!d.shiftKey);return w3c_slidy.cancel(d)}else{if(c==36){w3c_slidy.first_slide();return w3c_slidy.cancel(d)}else{if(c==35){w3c_slidy.last_slide();return w3c_slidy.cancel(d)}else{if(c==39){w3c_slidy.next_slide(!d.shiftKey);return w3c_slidy.cancel(d)}else{if(c==13){if(w3c_slidy.outline){if(w3c_slidy.outline.visible){w3c_slidy.fold(w3c_slidy.outline)}else{w3c_slidy.unfold(w3c_slidy.outline)}return w3c_slidy.cancel(d)}}else{if(c==188){w3c_slidy.smaller();return w3c_slidy.cancel(d)}else{if(c==190){w3c_slidy.bigger();return w3c_slidy.cancel(d)}else{if(c==189||c==109){w3c_slidy.smaller();return w3c_slidy.cancel(d)}else{if(c==187||c==191||c==107){w3c_slidy.bigger();return w3c_slidy.cancel(d)}else{if(c==83){w3c_slidy.smaller();return w3c_slidy.cancel(d)}else{if(c==66){w3c_slidy.bigger();return w3c_slidy.cancel(d)}else{if(c==90){w3c_slidy.last_slide();return w3c_slidy.cancel(d)}else{if(c==70){w3c_slidy.toggle_toolbar();return w3c_slidy.cancel(d)}else{if(c==65){w3c_slidy.toggle_view();return w3c_slidy.cancel(d)}else{if(c==75){w3c_slidy.mouse_click_enabled=!w3c_slidy.mouse_click_enabled;var b=(w3c_slidy.mouse_click_enabled?"enabled":"disabled")+" mouse click advance";alert(w3c_slidy.localize(b));return w3c_slidy.cancel(d)}else{if(c==84||c==67){if(w3c_slidy.toc){w3c_slidy.toggle_table_of_contents()}return w3c_slidy.cancel(d)}else{if(c==72){window.location=w3c_slidy.help_page;return w3c_slidy.cancel(d)}}}}}}}}}}}}}}}}}}}}return true},create_element:function(a){if(this.xhtml&&(typeof document.createElementNS!="undefined")){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}return document.createElement(a)},get_element_style:function(d,b,c){if(d.currentStyle){return d.currentStyle[b]}else{if(window.getComputedStyle){var a=window.getComputedStyle(d,"");return a.getPropertyValue(c)}}return""},has_token:function(e,c){if(e){var d=/\w+/g;var a=e.match(d);for(var b=0;b<a.length;b++){if(a[b]==c){return true}}}return false},get_class_list:function(a){if(typeof a.className!="undefined"){return a.className}return a.getAttribute("class")},has_class:function(b,a){if(b.nodeType!=1){return false}var c=new RegExp("(^| )"+a+"W*");if(typeof b.className!="undefined"){return c.test(b.className)}return c.test(b.getAttribute("class"))},remove_class:function(b,a){var d=new RegExp("(^| )"+a+"W*");var c="";if(typeof b.className!="undefined"){c=b.className;if(c){c=c.replace(d,"");b.className=c}}else{c=b.getAttribute("class");if(c){c=c.replace(d,"");b.setAttribute("class",c)}}},add_class:function(b,a){if(!this.has_class(b,a)){if(typeof b.className!="undefined"){b.className+=" "+a}else{var c=b.getAttribute("class");c=c?c+" "+a:a;b.setAttribute("class",c)}}},incremental_elements:null,okay_for_incremental:function(a){if(!this.incremental_elements){var b=new Array();b.p=true;b.pre=true;b.li=true;b.blockquote=true;b.dt=true;b.dd=true;b.h2=true;b.h3=true;b.h4=true;b.h5=true;b.h6=true;b.span=true;b.address=true;b.table=true;b.tr=true;b.th=true;b.td=true;b.img=true;b.object=true;this.incremental_elements=b}return this.incremental_elements[a.toLowerCase()]},next_incremental_item:function(c){var b=this.is_xhtml?"br":"BR";var a=w3c_slidy.slides[w3c_slidy.slide_number];for(;;){c=w3c_slidy.next_node(a,c);if(c==null||c.parentNode==null){break}if(c.nodeType==1){if(c.nodeName==b){continue}if(w3c_slidy.has_class(c,"incremental")&&w3c_slidy.okay_for_incremental(c.nodeName)){return c}if(w3c_slidy.has_class(c.parentNode,"incremental")&&!w3c_slidy.has_class(c,"non-incremental")){return c}}}return c},previous_incremental_item:function(c){var b=this.is_xhtml?"br":"BR";var a=w3c_slidy.slides[w3c_slidy.slide_number];for(;;){c=w3c_slidy.previous_node(a,c);if(c==null||c.parentNode==null){break}if(c.nodeType==1){if(c.nodeName==b){continue}if(w3c_slidy.has_class(c,"incremental")&&w3c_slidy.okay_for_incremental(c.nodeName)){return c}if(w3c_slidy.has_class(c.parentNode,"incremental")&&!w3c_slidy.has_class(c,"non-incremental")){return c}}}return c},set_visibility_all_incremental:function(b){var a=this.next_incremental_item(null);if(b=="hidden"){while(a){w3c_slidy.add_class(a,"invisible");a=w3c_slidy.next_incremental_item(a)}}else{while(a){w3c_slidy.remove_class(a,"invisible");a=w3c_slidy.next_incremental_item(a)}}},reveal_next_item:function(a){a=w3c_slidy.next_incremental_item(a);if(a&&a.nodeType==1){w3c_slidy.remove_class(a,"invisible")}return a},hide_previous_item:function(a){if(a&&a.nodeType==1){w3c_slidy.add_class(a,"invisible")}return this.previous_incremental_item(a)},next_node:function(a,b){if(b==null){return a.firstChild}if(b.firstChild){return b.firstChild}if(b.nextSibling){return b.nextSibling}for(;;){b=b.parentNode;if(!b||b==a){break}if(b&&b.nextSibling){return b.nextSibling}}return null},previous_node:function(a,b){if(b==null){b=a.lastChild;if(b){while(b.lastChild){b=b.lastChild}}return b}if(b.previousSibling){b=b.previousSibling;while(b.lastChild){b=b.lastChild}return b}if(b.parentNode!=a){return b.parentNode}return null},previous_sibling_element:function(a){a=a.previousSibling;while(a&&a.nodeType!=1){a=a.previousSibling}return a},next_sibling_element:function(a){a=a.nextSibling;while(a&&a.nodeType!=1){a=a.nextSibling}return a},first_child_element:function(a){var b;for(b=a.firstChild;b;b=b.nextSibling){if(b.nodeType==1){break}}return b},first_tag:function(b,a){var c;if(!this.is_xhtml){a=a.toUpperCase()}for(c=b.firstChild;c;c=c.nextSibling){if(c.nodeType==1&&c.nodeName==a){break}}return c},hide_selection:function(){if(window.getSelection){var b=window.getSelection();if(b.rangeCount>0){var a=b.getRangeAt(0);a.collapse(false)}}else{var c=document.selection.createRange();c.collapse(false)}},get_selected_text:function(){try{if(window.getSelection){return window.getSelection().toString()}if(document.getSelection){return document.getSelection().toString()}if(document.selection){return document.selection.createRange().text}}catch(a){}return""},mouse_button_up:function(a){w3c_slidy.selected_text_len=w3c_slidy.get_selected_text().length},mouse_button_click:function(g){var c=false;var b=false;var d=false;var f;if(!g){var g=window.event}if(g.target){f=g.target}else{if(g.srcElement){f=g.srcElement}}if(f.nodeType==3){f=f.parentNode}if(g.which){b=(g.which==1);d=(g.which==2);c=(g.which==3)}else{if(g.button){if(g.button==4){d=true}c=(g.button==2)}else{b=true}}if(w3c_slidy.selected_text_len>0){w3c_slidy.stop_propagation(g);g.cancel=true;g.returnValue=false;return false}w3c_slidy.hide_table_of_contents(false);var a=f.nodeName.toLowerCase();if(w3c_slidy.mouse_click_enabled&&b&&!w3c_slidy.special_element(f)&&!f.onclick){w3c_slidy.next_slide(true);w3c_slidy.stop_propagation(g);g.cancel=true;g.returnValue=false;return false}return true},special_element:function(b){var a=b.nodeName.toLowerCase();return b.onkeydown||b.onclick||a=="a"||a=="embed"||a=="object"||a=="video"||a=="audio"||a=="input"||a=="textarea"||a=="select"||a=="option"},slidy_chrome:function(a){while(a){if(a==w3c_slidy.toc||a==w3c_slidy.toolbar||w3c_slidy.has_class(a,"outline")){return true}a=a.parentNode}return false},get_key:function(b){var a;if(typeof window.event!="undefined"){a=window.event.keyCode}else{if(b.which){a=b.which}}return a},get_target:function(b){var a;if(!b){b=window.event}if(b.target){a=b.target}else{if(b.srcElement){a=b.srcElement}}if(a.nodeType!=1){a=a.parentNode}return a},is_block:function(b){var a=b.nodeName.toLowerCase();return a=="ol"||a=="ul"||a=="p"||a=="li"||a=="table"||a=="pre"||a=="h1"||a=="h2"||a=="h3"||a=="h4"||a=="h5"||a=="h6"||a=="blockquote"||a=="address"},add_listener:function(a,c,b){if(window.addEventListener){a.addEventListener(c,b,false)}else{a.attachEvent("on"+c,b)}},stop_propagation:function(a){a=a?a:window.event;a.cancelBubble=true;if(a.stopPropagation){a.stopPropagation()}return true},cancel:function(a){if(a){a.cancel=true;a.returnValue=false;if(a.preventDefault){a.preventDefault()}}w3c_slidy.key_wanted=false;return false},strings_es:{slide:"pág.","help?":"Ayuda","contents?":"Índice","table of contents":"tabla de contenidos","Table of Contents":"Tabla de Contenidos","restart presentation":"Reiniciar presentación","restart?":"Inicio"},help_es:"Utilice el ratón, barra espaciadora, teclas Izda/Dcha, o Re pág y Av pág. Use S y B para cambiar el tamaño de fuente.",strings_ca:{slide:"pàg..","help?":"Ajuda","contents?":"Índex","table of contents":"taula de continguts","Table of Contents":"Taula de Continguts","restart presentation":"Reiniciar presentació","restart?":"Inici"},help_ca:"Utilitzi el ratolí, barra espaiadora, tecles Esq./Dta. o Re pàg y Av pàg. Usi S i B per canviar grandària de font.",strings_cs:{slide:"snímek","help?":"nápověda","contents?":"obsah","table of contents":"obsah prezentace","Table of Contents":"Obsah prezentace","restart presentation":"znovu spustit prezentaci","restart?":"restart"},help_cs:"Prezentaci můžete procházet pomocí kliknutí myši, mezerníku, šipek vlevo a vpravo nebo kláves PageUp a PageDown. Písmo se dá zvětšit a zmenšit pomocí kláves B a S.",strings_nl:{slide:"pagina","help?":"Help?","contents?":"Inhoud?","table of contents":"inhoudsopgave","Table of Contents":"Inhoudsopgave","restart presentation":"herstart presentatie","restart?":"Herstart?"},help_nl:"Navigeer d.m.v. het muis, spatiebar, Links/Rechts toetsen, of PgUp en PgDn. Gebruik S en B om de karaktergrootte te veranderen.",strings_de:{slide:"Seite","help?":"Hilfe","contents?":"Übersicht","table of contents":"Inhaltsverzeichnis","Table of Contents":"Inhaltsverzeichnis","restart presentation":"Präsentation neu starten","restart?":"Neustart"},help_de:"Benutzen Sie die Maus, Leerschlag, die Cursortasten links/rechts oder Page up/Page Down zum Wechseln der Seiten und S und B für die Schriftgrösse.",strings_pl:{slide:"slajd","help?":"pomoc?","contents?":"spis treści?","table of contents":"spis treści","Table of Contents":"Spis Treści","restart presentation":"Restartuj prezentację","restart?":"restart?"},help_pl:"Zmieniaj slajdy klikając myszą, naciskając spację, strzałki lewo/prawolub PgUp / PgDn. Użyj klawiszy S i B, aby zmienić rozmiar czczionki.",strings_fr:{slide:"page","help?":"Aide","contents?":"Index","table of contents":"table des matières","Table of Contents":"Table des matières","restart presentation":"Recommencer l'exposé","restart?":"Début"},help_fr:"Naviguez avec la souris, la barre d'espace, les flèches gauche/droite ou les touches Pg Up, Pg Dn. Utilisez les touches S et B pour modifier la taille de la police.",strings_hu:{slide:"oldal","help?":"segítség","contents?":"tartalom","table of contents":"tartalomjegyzék","Table of Contents":"Tartalomjegyzék","restart presentation":"bemutató újraindítása","restart?":"újraindítás"},help_hu:"Az oldalak közti lépkedéshez kattintson az egérrel, vagy használja a szóköz, a bal, vagy a jobb nyíl, illetve a Page Down, Page Up billentyűket. Az S és a B billentyűkkel változtathatja a szöveg méretét.",strings_it:{slide:"pag.","help?":"Aiuto","contents?":"Indice","table of contents":"indice","Table of Contents":"Indice","restart presentation":"Ricominciare la presentazione","restart?":"Inizio"},help_it:"Navigare con mouse, barra spazio, frecce sinistra/destra o PgUp e PgDn. Usare S e B per cambiare la dimensione dei caratteri.",strings_el:{slide:"σελίδα","help?":"βοήθεια;","contents?":"περιεχόμενα;","table of contents":"πίνακας περιεχομένων","Table of Contents":"Πίνακας Περιεχομένων","restart presentation":"επανεκκίνηση παρουσίασης","restart?":"επανεκκίνηση;"},help_el:"Πλοηγηθείτε με το κλίκ του ποντικιού, το space, τα βέλη αριστερά/δεξιά, ή Page Up και Page Down. Χρησιμοποιήστε τα πλήκτρα S και B για να αλλάξετε το μέγεθος της γραμματοσειράς.",strings_ja:{slide:"スライド","help?":"ヘルプ","contents?":"目次","table of contents":"目次を表示","Table of Contents":"目次","restart presentation":"最初から再生","restart?":"最初から"},help_ja:"マウス左クリック ・ スペース ・ 左右キー または Page Up ・ Page Downで操作， S ・ Bでフォントサイズ変更",strings_zh:{slide:"幻灯片","help?":"帮助?","contents?":"内容?","table of contents":"目录","Table of Contents":"目录","restart presentation":"重新启动展示","restart?":"重新启动?"},help_zh:"用鼠标点击, 空格条, 左右箭头, Pg Up 和 Pg Dn 导航. 用 S, B 改变字体大小.",strings_ru:{slide:"слайд","help?":"помощь?","contents?":"содержание?","table of contents":"оглавление","Table of Contents":"Оглавление","restart presentation":"перезапустить презентацию","restart?":"перезапуск?"},help_ru:"Перемещайтесь кликая мышкой, используя клавишу пробел, стрелкивлево/вправо или Pg Up и Pg Dn. Клавиши S и B меняют размер шрифта.",strings_sv:{slide:"sida","help?":"hjälp","contents?":"innehåll","table of contents":"innehållsförteckning","Table of Contents":"Innehållsförteckning","restart presentation":"visa presentationen från början","restart?":"börja om"},help_sv:"Bläddra med ett klick med vänstra musknappen, mellanslagstangenten, vänster- och högerpiltangenterna eller tangenterna Pg Up, Pg Dn. Använd tangenterna S och B för att ändra textens storlek.",strings:{},localize:function(d){if(d==""){return d}var b,c=w3c_slidy.strings[w3c_slidy.lang];if(c){b=c[d];if(b){return b}}var a=w3c_slidy.lang.split("-");if(a.length>1){c=w3c_slidy.strings[a[0]];if(c){b=c[d];if(b){return b}}}return d},init_localization:function(){var b=w3c_slidy;var a=w3c_slidy.help_text;this.strings={es:this.strings_es,ca:this.strings_ca,cs:this.strings_cs,nl:this.strings_nl,de:this.strings_de,pl:this.strings_pl,fr:this.strings_fr,hu:this.strings_hu,it:this.strings_it,el:this.strings_el,jp:this.strings_ja,zh:this.strings_zh,ru:this.strings_ru,sv:this.strings_sv},b.strings_es[a]=b.help_es;b.strings_ca[a]=b.help_ca;b.strings_cs[a]=b.help_cs;b.strings_nl[a]=b.help_nl;b.strings_de[a]=b.help_de;b.strings_pl[a]=b.help_pl;b.strings_fr[a]=b.help_fr;b.strings_hu[a]=b.help_hu;b.strings_it[a]=b.help_it;b.strings_el[a]=b.help_el;b.strings_ja[a]=b.help_ja;b.strings_zh[a]=b.help_zh;b.strings_ru[a]=b.help_ru;b.strings_sv[a]=b.help_sv;w3c_slidy.lang=document.body.parentNode.getAttribute("lang");if(!w3c_slidy.lang){w3c_slidy.lang=document.body.parentNode.getAttribute("xml:lang")}if(!w3c_slidy.lang){w3c_slidy.lang="en"}}};if(w3c_slidy.ie6||w3c_slidy.ie7){document.write("<iframe id='historyFrame' src='javascript:\"<html></html>\"' height='1' width='1' style='position:absolute;left:-800px'></iframe>")}w3c_slidy.set_up();setTimeout(w3c_slidy.hide_slides,50);
  </script>
</head>
<body>
<div class="slide cover title">
  <h1 class="title">Folds and parallelism</h1>
  <p class="author">

  </p>
</div>
<div class="slide">

<h1>A Monday recap</h1>
<p>Someone asked a thoughtful question on Monday about folds, specifically about <code>foldr</code> vs <code>foldl</code> and <code>foldl'</code>.</p>
<p>I wasn't very happy with the answers I came up with, because I was in a bit of a rush.</p>
<ul>
<li><p>Always be suspicious of teachers who get into a muddle if you spring an unexpected question!</p></li>
<li><p>Do they really know what they're talking about, or are they just good at reading slides?</p></li>
</ul>
<p>Today, let's slow down and think about folds a little more.</p>
</div>

<div class="slide">

<h1>Folding from the right</h1>
<p>Here's the definition of <code>foldr</code>:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">foldr</span><span class="ot"> </span><span class="ot">::</span> (a <span class="ot">-&gt;</span> b <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> b <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> b<br /><span class="fu">foldr</span> f <span class="fu">=</span> go<br />  <span class="kw">where</span><br />    go (x<span class="fu">:</span>xs) <span class="fu">=</span> f x (go xs)<br />    go z      <span class="fu">=</span> z</code></pre>
<p>It associates to the right, so here's what a use of <code>foldr</code> looks like, expanded:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">foldr</span> f z [a,b,c,d] <span class="fu">=</span> f a (f b (f c (f d z)))</code></pre>
</div>

<div class="slide">

<h1>foldr and strictness: 0 of n</h1>
<p>Suppose we want to sum the elements of a list using <code>foldr</code>:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">foldr</span> (<span class="fu">+</span>) <span class="dv">0</span> [<span class="dv">3</span><span class="fu">..</span><span class="dv">6</span>]</code></pre>
<p>In order for the <code>(+)</code> operator to add two numbers, it has to know what each one is, so at least for the usual types we work with, it's <em>strict</em> in both of its arguments.</p>
<p>(Note: <code>(+)</code> is not required to be strict. That behaviour depends on the instance of <code>Num</code> in use.)</p>
</div>

<div class="slide">

<h1>foldr and strictness: 1 of n</h1>
<p>Let's do a stepwise expansion of the <code>foldr</code>-based sum.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">foldr</span> (<span class="fu">+</span>) <span class="dv">0</span> (<span class="dv">3</span><span class="fu">:</span><span class="co">{-...-}</span>) <span class="fu">=</span> <span class="dv">3</span> <span class="fu">+</span> <span class="co">{-...-}</span></code></pre>
<p>We can't produce an answer after consuming the first element of the list, because <code>+</code> is strict in its arguments.</p>
</div>

<div class="slide">

<h1>foldr and strictness: 2 of n</h1>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">foldr</span> (<span class="fu">+</span>) <span class="dv">0</span> (<span class="dv">3</span><span class="fu">:</span><span class="dv">4</span><span class="fu">:</span><span class="co">{-...-}</span>) <span class="fu">=</span> <span class="dv">3</span> <span class="fu">+</span> (<span class="dv">4</span> <span class="fu">+</span> <span class="co">{-...-}</span>)</code></pre>
<p>Neither can we produce an answer after the second element.</p>
<p>In fact, we're building up an expression that we can't reduce to a smaller form, because we're associating to the right and we haven't seen the rest of the list yet (see the definition of <code>foldr</code>).</p>
</div>

<div class="slide">

<h1>foldr and strictness: n of n</h1>
<p>In fact, not until we reach the end of the list do we have a number on the right hand side of a <code>+</code>:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">foldr</span> (<span class="fu">+</span>) <span class="dv">0</span> (<span class="dv">3</span><span class="fu">:</span><span class="dv">4</span><span class="fu">:</span><span class="dv">5</span><span class="fu">:</span><span class="dv">6</span><span class="fu">:</span>[]) <span class="fu">=</span> <span class="dv">3</span> <span class="fu">+</span> (<span class="dv">4</span> <span class="fu">+</span> (<span class="dv">5</span> <span class="fu">+</span> (<span class="dv">6</span> <span class="fu">+</span> <span class="dv">0</span>)))</code></pre>
<p>What we've done is build up a big expression that we can't evaluate until we've seen the entire list.</p>
<p>This is due in equal part to two factors:</p>
<ul>
<li><p><code>foldr</code> is right associative.</p></li>
<li><p>The function we're folding with is strict in both arguments.</p></li>
</ul>
</div>

<div class="slide">

<h1>So how about foldl?</h1>
<p>If <code>foldr</code> was getting us all screwed up due to the associativity, maybe <code>foldl</code> will do better.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">foldl</span><span class="ot"> </span><span class="ot">::</span> (a <span class="ot">-&gt;</span> b <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [b] <span class="ot">-&gt;</span> a<br /><span class="fu">foldl</span> f <span class="fu">=</span> go<br />  <span class="kw">where</span><br />    go z (x<span class="fu">:</span>xs) <span class="fu">=</span> go (f z x) xs<br />    go z _      <span class="fu">=</span> z</code></pre>
<p>Let's see an expansion.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">foldl</span> f z [a,b,c,d] <span class="fu">=</span> f (f (f (f z a) b) c) d</code></pre>
<p>Ouch! Maybe we can make that clearer with infix syntax?</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">foldl</span> (<span class="fu">+</span>) z [a,b,c,d] <span class="fu">=</span> (((z <span class="fu">+</span> a) <span class="fu">+</span> b) <span class="fu">+</span> c) <span class="fu">+</span> d</code></pre>
</div>

<div class="slide">

<h1>foldl and strictness</h1>
<p>For summing elements, this looks better than <code>foldr</code> on the face of things, because at every step through the list, the function we're folding with can see both of its arguments.</p>
<p>But there's a catch.</p>
<p>None of the intermediate results are visible to the caller of <code>foldl</code>, so the caller cannot force those results to be evaluated.</p>
<p>In other words, we're still building up a big thunk!</p>
</div>

<div class="slide">

<h1>A strict left fold</h1>
<p>This function is defined for us in <code>Data.List</code>, and it has the same type as <code>foldl</code>:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE BangPatterns #-}</span><br /><br /><span class="ot">foldl' </span><span class="ot">::</span> (a <span class="ot">-&gt;</span> b <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [b] <span class="ot">-&gt;</span> a<br />foldl' f <span class="fu">=</span> go<br />  <span class="kw">where</span><br />    go <span class="fu">!</span>z (x<span class="fu">:</span>xs) <span class="fu">=</span> go (f z x) xs<br />    go <span class="fu">!</span>z  _     <span class="fu">=</span> z</code></pre>
<p>The crucial difference lies with the strictness annotation, which forces each intermediate result to be evaluated to WHNF.</p>
</div>

<div class="slide">

<h1>foldl' and strictness: 1 of n</h1>
<p>That same sum again.</p>
<pre class="sourceCode"><code class="sourceCode haskell">foldl' (<span class="fu">+</span>) <span class="dv">0</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</code></pre>
<p>First step:</p>
<pre class="sourceCode"><code class="sourceCode haskell">foldl' (<span class="fu">+</span>) <span class="dv">0</span> (<span class="dv">1</span><span class="fu">:</span><span class="co">{-...-}</span>) <span class="fu">=</span> foldl' (<span class="dv">0</span><span class="fu">+</span><span class="dv">1</span>) <span class="co">{-...-}</span><br />                         <span class="fu">=</span> foldl' <span class="dv">1</span>     <span class="co">{-...-}</span></code></pre>
</div>

<div class="slide">

<h1>foldl' and strictness: 2 of n</h1>
<p>Second step:</p>
<pre class="sourceCode"><code class="sourceCode haskell">foldl' (<span class="fu">+</span>) <span class="dv">1</span> (<span class="dv">2</span><span class="fu">:</span><span class="co">{-...-}</span>) <span class="fu">=</span> foldl' (<span class="dv">1</span><span class="fu">+</span><span class="dv">2</span>) <span class="co">{-...-}</span><br />                         <span class="fu">=</span> foldl' <span class="dv">2</span>     <span class="co">{-...-}</span></code></pre>
<p>The structure of <code>foldl'</code> causes us to replace the accumulator <code>z</code> with a new value at each step.</p>
<p>The strictness annotation (we could have used <code>seq</code> too) causes that accumulator to be evaluated to WHNF before we continue.</p>
</div>

<div class="slide">

<h1>foldl' and strictness: n of n</h1>
<p>Last step:</p>
<pre class="sourceCode"><code class="sourceCode haskell">foldl' (<span class="fu">+</span>) <span class="dv">3</span> [] <span class="fu">=</span> <span class="dv">3</span></code></pre>
<p>I hope this makes the difference between <code>foldl'</code> and <code>foldr</code> more apparent!</p>
</div>

<div class="slide">

<h1>Don't use foldl</h1>
<p>It should be clear by now that plain old <code>foldl</code> is very rarely useful.</p>
<p>In fact, I've <em>never</em> personally found a situation where it was the right kind of fold to use.</p>
<p>If you find yourself thinking &quot;I need a left fold&quot;, it's safe to assume that <code>foldl'</code> is what you'll need.</p>
</div>

<div class="slide">

<h1>foldr and laziness</h1>
<p>We've discussed the fact that using <code>foldr</code> with a strict function is a bad idea, because it generates a chain of thunks.</p>
<p>What if we used a function that was <em>lazy</em> in its second argument?</p>
<p>Hmm. Conveniently enough, we have an everyday example of just such a function: the list constructor!</p>
<p>What does this function do?</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">foldr</span> (<span class="fu">:</span>) []</code></pre>
</div>

<div class="slide">

<h1>A handy way to think about foldr</h1>
<p>Let's do another expansion, but this time we'll align the input list and result expression lexically:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">foldr</span> (<span class="fu">&lt;+&gt;</span>) z <br />  (a  <span class="fu">:</span>  (b  <span class="fu">:</span>  (c  <span class="fu">:</span>  (d  <span class="fu">:</span>  [])))) <span class="fu">=</span><br />  (a <span class="fu">&lt;+&gt;</span> (b <span class="fu">&lt;+&gt;</span> (c <span class="fu">&lt;+&gt;</span> (d <span class="fu">&lt;+&gt;</span> z ))))</code></pre>
<p>Notice that each <code>(:)</code> in the input list is &quot;replaced&quot; by an application of <code>(&lt;+&gt;)</code> in the result, and the <code>[]</code> at the end is replaced with <code>z</code>.</p>
<p>(It doesn't matter what <code>(&lt;+&gt;)</code> actually does here. We're purely interested in the structures of the two expressions.)</p>
</div>

<div class="slide">

<h1>Quick exercise 1: map</h1>
<p>Write a version of <code>map</code> that does not pattern match on its input list, but instead uses <code>foldr</code>:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">map</span><span class="ot"> </span><span class="ot">::</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> [b]<br /><br /><span class="fu">map</span> (<span class="fu">+</span><span class="dv">1</span>) [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>] <span class="fu">==</span> [<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]</code></pre>
</div>

<div class="slide">

<h1>Quick exercise 1: my implementation</h1>
<pre class="sourceCode"><code class="sourceCode haskell">myMap f <span class="fu">=</span> <span class="fu">foldr</span> go []<br />  <span class="kw">where</span> go x xs <span class="fu">=</span> f x <span class="fu">:</span> xs</code></pre>
</div>

<div class="slide">

<h1>Quick exercise 2: filter</h1>
<p>Write a version of <code>filter</code> that again uses <code>foldr</code>:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">filter</span><span class="ot"> </span><span class="ot">::</span> (a <span class="ot">-&gt;</span> <span class="dt">Bool</span>) <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> [a]<br /><br /><span class="fu">filter</span> <span class="fu">odd</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">5</span>] <span class="fu">==</span> [<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>]</code></pre>
</div>

<div class="slide">

<h1>Quick exercise 2: my version</h1>
<pre class="sourceCode"><code class="sourceCode haskell">myFilter p <span class="fu">=</span> <span class="fu">foldr</span> go []<br />  <span class="kw">where</span><br />    go x xs<br />      <span class="fu">|</span> p x       <span class="fu">=</span> x <span class="fu">:</span> xs<br />      <span class="fu">|</span> <span class="fu">otherwise</span> <span class="fu">=</span> xs</code></pre>
</div>

<div class="slide">

<h1>Quick exercise 3: append</h1>
<p>Write an <code>append</code> function that has the same behaviour as the <code>(++)</code> operator:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">(++) </span><span class="ot">::</span> [a] <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> [a]<br /><br />[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>] <span class="fu">++</span> [<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>] <span class="fu">==</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]</code></pre>
<p>For bonus points, make your implementation as short as possible.</p>
</div>

<div class="slide">

<h1>Quick exercise 3: mine</h1>
<pre class="sourceCode"><code class="sourceCode haskell">append <span class="fu">=</span> <span class="fu">flip</span> (<span class="fu">foldr</span> (<span class="fu">:</span>))</code></pre>
</div>

<div class="slide">

<h1>Parallelism vs concurrency</h1>
<p>A handy rule of thumb for distinguishing the two:</p>
<ul>
<li><p>Concurrency: &quot;I have a number of potentially unrelated tasks to deal with.&quot;</p></li>
<li><p>Parallelism: &quot;I want my single question to be answered sooner if I can throw more resources at the problem.&quot;</p></li>
</ul>
<p>Many languages blur these notions together, by providing a &quot;one size fits all&quot; toolkit for concurrency and parallelism.</p>
</div>

<div class="slide">

<h1>What does a concurrent system need?</h1>
<p>We do not need multiple CPU cores to achieve concurrent processing, nor do we even need threads.</p>
<p>However, a good language runtime and programming environment <em>will</em> offer improved throughput and latency on concurrent problems if it can use multiple cores.</p>
</div>

<div class="slide">

<h1>What about a parallel system?</h1>
<p>The essence of parallel programming is to have multiple computing elements process parts of a problem simultaneously.</p>
<p>GHC provides a &quot;baked in&quot; way of using multiple CPU cores to do this.</p>
<p>To take advantage of this, we <em>must</em> build our executables with <code>-threaded</code>.</p>
<p>This links a Haskell program against the &quot;threaded runtime&quot;, which can schedule lightweight Haskell threads across multiple CPU cores, and which can also run parallel programs on those cores.</p>
</div>

<div class="slide">

<h1>Low-level parallel programming</h1>
<p>In the <code>Control.Parallel</code> module lives an intriguing function.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">par </span><span class="ot">::</span> a <span class="ot">-&gt;</span> b <span class="ot">-&gt;</span> b</code></pre>
<p>This is the parallel cousin to <code>seq</code>. It tells the threaded runtime that it may be beneficial to evaluate the first argument in parallel with the second.</p>
<p>Like <code>seq</code>, <code>par</code> returns the value of its second argument.</p>
</div>

<div class="slide">

<h1>pseq</h1>
<p>As it happens, we need another oddball function to work with <code>par</code>.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">pseq </span><span class="ot">::</span> a <span class="ot">-&gt;</span> b <span class="ot">-&gt;</span> b</code></pre>
<p>This is semantically identical to <code>seq</code>, but with a subtle operational difference.</p>
<p><code>seq</code> is strict in <em>both</em> arguments, so the compiler can take an expression like this:</p>
<pre class="sourceCode"><code class="sourceCode haskell">a <span class="ot">`seq`</span> b </code></pre>
<p>And transform it into this:</p>
<pre class="sourceCode"><code class="sourceCode haskell">b <span class="ot">`seq`</span> a <span class="ot">`seq`</span> b</code></pre>
<p>This can be a problem when annotating code for parallelism, when we need more control over the order of evaluation.</p>
<p>In contrast to <code>seq</code>, <code>pseq</code> is only strict in its <em>first</em> argument.</p>
<p>This restricts the transformations that the compiler can perform, and lets us retain control of the evaluation order.</p>
</div>

<div class="slide">

<h1>When to use par</h1>
<p>We use <code>par</code> when two conditions are true:</p>
<ul>
<li><p>The first argument is somewhat expensive to compute.</p></li>
<li><p>We don't have an immediate need for the result of the first computation.</p></li>
</ul>
<p>If the first argument is too cheap, then the book-keeping overhead to evaluate it in parallel will diminish or erase any performance gain.</p>
</div>

<div class="slide">

<h1>Futures</h1>
<p>The <code>par</code> operator makes use of the overlap between lazy evaluation and futures.</p>
<p>To implement lazy evaluation, we need <em>thunks</em>: a representation for expressions which are not yet evaluated but whose value may later be demanded.</p>
<p>A <em>future</em> is a computation whose value is being evaluated in parallel and which we may wait for.</p>
<p><code>par</code> offers a way to annotate a lazy computation as being potentially profitable to evaluate in parallel.</p>
<p>In other words, it turns a lazy computation into a future.</p>
</div>

<div class="slide">

<h1>O rly?</h1>
<p>In practice, <code>par</code> and <code>pseq</code> are a pain in the neck to use.</p>
<p>To use <code>par</code> effectively, we have to get some surprisingly subtle things right:</p>
<ol style="list-style-type: decimal">
<li><p>Pass an unevaluated computation to <code>par</code></p></li>
<li><p>The unevaluated computation must be somewhat expensive</p></li>
<li><p>Ensure that its value will not be required by the enclosing computation for a while</p></li>
<li><p>Ensure that the result is shared by the rest of the program</p></li>
</ol>
<p>If we miss any of 1 through 3, then we achieve little or no speedup.</p>
<p>If we miss 4, then the GC may get rid of the computed result before it can be used.</p>
<ul>
<li>In practice, even experts fall afoul of these requirements on a regular basis.</li>
</ul>
</div>

<div class="slide">

<h1>The Par monad</h1>
<p>The <code>monad-par</code> package provides a library that makes parallelism easier to achieve and reason about.</p>
<pre><code>cabal install monad-par
</code></pre>
<p>It gives us a type named <code>Par</code>:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">newtype</span> <span class="dt">Par</span> a<br /><br /><span class="kw">instance</span> <span class="kw">Functor</span> <span class="dt">Par</span><br /><span class="kw">instance</span> <span class="dt">Applicative</span> <span class="dt">Par</span><br /><span class="kw">instance</span> <span class="kw">Monad</span> <span class="dt">Par</span></code></pre>
<p>To evaluate a <code>Par</code> computation, we use <code>runPar</code>:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">runPar </span><span class="ot">::</span> <span class="dt">Par</span> a <span class="ot">-&gt;</span> a</code></pre>
<p>Notice that this has no side effects, so it will run deterministically.</p>
</div>

<div class="slide">

<h1>Building blocks</h1>
<p>To start a parallel computation, we use the <code>fork</code> action:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">fork </span><span class="ot">::</span> <span class="dt">Par</span> () <span class="ot">-&gt;</span> <span class="dt">Par</span> ()</code></pre>
<p>Forked tasks need a way to communicate with each other, for which we use the <code>IVar</code> type:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">IVar</span> a<br />    <span class="kw">deriving</span> (<span class="kw">Eq</span>)<br /><br /><span class="ot">new </span><span class="ot">::</span> <span class="dt">Par</span> (<span class="dt">IVar</span> a)<br /><span class="ot">get </span><span class="ot">::</span> <span class="dt">IVar</span> a <span class="ot">-&gt;</span> <span class="dt">Par</span> a<br /><span class="ot">put </span><span class="ot">::</span> (<span class="dt">NFData</span> a) <span class="ot">=&gt;</span> <span class="dt">IVar</span> a <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">Par</span> ()</code></pre>
<p>The <code>IVar</code> type is a <em>write-once</em> mutable reference. The <code>get</code> function blocks until a <code>put</code> has been performed.</p>
</div>

<div class="slide">

<h1>The NFData class</h1>
<p>We know that <code>seq</code> evaluates an expression to WHNF, but sometimes we want to completely evaluate an expression to normal form.</p>
<p>Enter the <code>deeqseq</code> package:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">import</span> <span class="dt">Control.DeepSeq</span><br /><br /><span class="kw">class</span> <span class="dt">NFData</span> a <span class="kw">where</span><br /><span class="ot">    rnf </span><span class="ot">::</span> a <span class="ot">-&gt;</span> ()</code></pre>
<p>We can write an <code>NFData</code> instance for any custom type. Our <code>rnf</code> implementation must reduce an expression to normal form.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">Foo</span> a <span class="fu">=</span> <span class="dt">Foo</span> <span class="dt">Int</span> a<br /><br /><span class="kw">instance</span> (<span class="dt">NFData</span> a) <span class="ot">=&gt;</span> <span class="dt">NFData</span> (<span class="dt">Foo</span> a) <span class="kw">where</span><br />    rnf (<span class="dt">Foo</span> x y) <span class="fu">=</span> rnf x <span class="ot">`seq`</span> rnf y</code></pre>
</div>

<div class="slide">

<h1>Higher level operations</h1>
<p>An extremely common pattern is for a thread to <code>fork</code> several children and wait for them to finish.</p>
<p>We can easily capture this idea with a suitable combinator.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">spawn </span><span class="ot">::</span> (<span class="dt">NFData</span> a) <span class="ot">=&gt;</span> <span class="dt">Par</span> a <span class="ot">-&gt;</span> <span class="dt">Par</span> (<span class="dt">IVar</span> a)<br />spawn act <span class="fu">=</span> <span class="kw">do</span><br />  i <span class="ot">&lt;-</span> new<br />  fork (put i <span class="fu">=&lt;&lt;</span> act)<br />  <span class="fu">return</span> i</code></pre>
<p>In fact, usually all we want is to simply wait for all children and return a list of their results.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">parMapM </span><span class="ot">::</span> (<span class="dt">NFData</span> b) <span class="ot">=&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">Par</span> b) <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> <span class="dt">Par</span> [b]<br />parMapM f acts <span class="fu">=</span> <span class="kw">do</span> <br />  ivars <span class="ot">&lt;-</span> <span class="fu">mapM</span> (spawn <span class="fu">.</span> f) acts<br />  <span class="fu">mapM</span> get ivars</code></pre>
</div>

<div class="slide">

<h1>Computing the mean of a sample</h1>
<p>Suppose we need the mean of a list of numbers. The naive way to do so would be <code>sum xs / length xs</code>, but this has numerical stability problems.</p>
<p>Here's a more stable method:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">import</span> <span class="dt">Data.List</span><br /><br /><span class="kw">data</span> <span class="dt">T</span> a <span class="fu">=</span> <span class="dt">T</span> <span class="fu">!</span>a <span class="fu">!</span><span class="dt">Int</span><br /><br /><span class="ot">mean </span><span class="ot">::</span> (<span class="kw">RealFrac</span> a) <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span> a<br />mean <span class="fu">=</span> fini <span class="fu">.</span> foldl' go (<span class="dt">T</span> <span class="dv">0</span> <span class="dv">0</span>)<br />  <span class="kw">where</span><br />    fini (<span class="dt">T</span> a _) <span class="fu">=</span> a<br />    go (<span class="dt">T</span> m n) x <span class="fu">=</span> <span class="dt">T</span> m' n'<br />      <span class="kw">where</span> m' <span class="fu">=</span> m <span class="fu">+</span> (x <span class="fu">-</span> m) <span class="fu">/</span> <span class="fu">fromIntegral</span> n'<br />            n' <span class="fu">=</span> n <span class="fu">+</span> <span class="dv">1</span></code></pre>
</div>

<div class="slide">

<h1>Questionable numbers</h1>
<p>Supposing we have a set of sample data that we know little about, in particular its precision and variance.</p>
<p>This is exactly the kind of problem that the criterion benchmarking library faces: we have performance data, but it's dirty and doesn't follow any particular statistical distribution.</p>
<p>A technique called the <a href="http://en.wikipedia.org/wiki/Resampling_(statistics)">jackknife</a> lets us estimate these parameters.</p>
<p>We successively recompute a function (such as <code>mean</code>) over subsets of a sample, each time with a sliding window cut out.</p>
<p>For a <span class="math"><em>w</em></span>-width window and <span class="math"><em>k</em></span> samples, the jackknife has a cost of <span class="math"><em>O</em>((<em>k</em> - <em>w</em>)<sup>2</sup>)</span>.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">jackknife </span><span class="ot">::</span> ([a] <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> [b]<br />jackknife f <span class="fu">=</span> <span class="fu">map</span> f <span class="fu">.</span> resamples <span class="dv">500</span></code></pre>
</div>

<div class="slide">

<h1>Resampling</h1>
<p>It's easy to write a resampling function using familiar building blocks.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">resamples </span><span class="ot">::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> [[a]]<br />resamples k xs <span class="fu">=</span><br />    <span class="fu">take</span> (<span class="fu">length</span> xs <span class="fu">-</span> k) <span class="fu">$</span><br />    <span class="fu">zipWith</span> (<span class="fu">++</span>) (inits xs) (<span class="fu">map</span> (<span class="fu">drop</span> k) (tails xs))</code></pre>
<p>Our function resamples a list with a window size of <code>k</code>.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="fu">&gt;&gt;</span> resamples <span class="dv">2</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">5</span>]<br />[[    <span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>],<br /> [<span class="dv">0</span>,    <span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>],<br /> [<span class="dv">0</span>,<span class="dv">1</span>,    <span class="dv">4</span>,<span class="dv">5</span>],<br /> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,    <span class="dv">5</span>]]</code></pre>
</div>

<div class="slide">

<h1>Speeding up the jackknife</h1>
<p>The nice thing about the jackknife is that each element of the result list is independent, so it's an &quot;embarrassingly parallel&quot; problem.</p>
<p>The <code>monad-par</code> package is very helpful in making this trivial to parallelize.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">import</span> <span class="dt">Control.Monad.Par</span> (runPar, parMap)<br /><br />jackknifeP f <span class="fu">=</span> runPar <span class="fu">.</span> parMap f <span class="fu">.</span> resamples <span class="dv">500</span></code></pre>
<p>Let's try it out!</p>
</div>

<div class="slide">

<h1>Suitably noisy data</h1>
<div class="figure">
<img src="http://www.scs.stanford.edu/11au-cs240h/notes/foo.png" alt="Noise!" /><p class="caption">Noise!</p>
</div>
</div>

<div class="slide">

<h1>A test program</h1>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">import</span> <span class="dt">System.Random.Mersenne</span><br /><br />crud <span class="fu">=</span> <span class="fu">zipWith</span> (\x a <span class="ot">-&gt;</span> <span class="fu">sin</span> (x <span class="fu">/</span> <span class="dv">300</span>)<span class="fu">**</span><span class="dv">2</span> <span class="fu">+</span> a) [<span class="dv">0</span><span class="fu">..</span>]<br /><br />main <span class="fu">=</span> <span class="kw">do</span><br />  (xs,ys) <span class="ot">&lt;-</span> <span class="fu">splitAt</span> <span class="dv">1500</span> <span class="fu">.</span> <span class="fu">take</span> <span class="dv">6000</span> <span class="fu">&lt;$&gt;</span> (randoms <span class="fu">=&lt;&lt;</span> getStdGen)<br />  <span class="kw">let</span> rs <span class="fu">=</span> crud xs <span class="fu">++</span> ys<br />  <span class="fu">putStrLn</span> <span class="fu">$</span> <span class="st">&quot;sample mean:    &quot;</span> <span class="fu">++</span> <span class="fu">show</span> (mean rs)<br /><br />  <span class="kw">let</span> j <span class="fu">=</span> jackknifeP mean rs<br />  <span class="fu">putStrLn</span> <span class="fu">$</span> <span class="st">&quot;jack mean min:  &quot;</span> <span class="fu">++</span> <span class="fu">show</span> (<span class="fu">minimum</span> j)<br />  <span class="fu">putStrLn</span> <span class="fu">$</span> <span class="st">&quot;jack mean max:  &quot;</span> <span class="fu">++</span> <span class="fu">show</span> (<span class="fu">maximum</span> j)</code></pre>
</div>

<div class="slide">

<h1>Compiling</h1>
<p>We have to remember to build using <em>both</em> <code>-threaded</code> and <code>-rtsopts</code>.</p>
<pre><code>ghc -O --make -rtsopts -threaded Jackknife
</code></pre>
<ul>
<li><p><code>-threaded</code> gives us the threaded runtime.</p></li>
<li><p>We'll need <code>-rtsopts</code> to tell the RTS how many cores to use. <em>It will default to just one if we do not specify otherwise</em>.</p></li>
</ul>
<p>To use e.g. 3 cores:</p>
<pre><code>./Jackknife +RTS -N3
</code></pre>
<p>If we want to use all cores:</p>
<pre><code>./Jackknife +RTS -N
</code></pre>
</div>

<div class="slide">

<h1>Other approaches to parallelism</h1>
<p>Meanwhile, <code>par</code> and the <code>monad-par</code> packages are not the only ways to achieve parallel speedups in Haskell.</p>
<p>There are other more &quot;researchy&quot; projects under way:</p>
<ul>
<li><p>For multicore machines: Data Parallel Haskell</p></li>
<li><p>For GPU computing: the accelerate package</p></li>
</ul>
</div>

<div class="slide">

<h1>Data Parallel Haskell</h1>
<p><a href="http://www.haskell.org/haskellwiki/GHC/Data_Parallel_Haskell">DPH</a> is the name of a research project to support <a href="http://www.cs.cmu.edu/~scandal/cacm/cacm2.html">nested data parallelism</a> under GHC on multicore CPUs.</p>
<p>Nested data parallelism extends the programming model of <em>flat</em> data parallelism, as known from modern Fortran dialects, to:</p>
<ul>
<li><p>Irregular parallel computations (such as divide-and-conquer algorithms) and</p></li>
<li><p>Irregular data structures (such as sparse matrices and tree structures).</p></li>
</ul>
<p>This project is still a work in progress, and is quite technically intricate.</p>
</div>

<div class="slide">

<h1>Accelerate</h1>
<p>The <a href="http://hackage.haskell.org/package/accelerate">accelerate library</a> defines an embedded language for regular, multi-dimensional array computations with multiple backends to facilitate high-performance implementations.</p>
<p>Currently, there are two backends:</p>
<ul>
<li><p>An interpreter that serves as a reference implementation of the intended semantics of the language.</p></li>
<li><p>A <a href="http://www.nvidia.com/object/cuda_home_new.html">CUDA</a> backend generating code for CUDA-capable NVIDIA GPUs.</p></li>
</ul>
</div>

<div class="slide">

<h1>Busting a myth</h1>
<p>You'll sometimes hear uninformed people claim that functional programming is some kind of magic pixie dust for parallel programming.</p>
<p>This is not really true.</p>
<p>Certainly, aspects of the programming model make incidental parts of the problem easier.</p>
<p>However, tricky considerations like data dependencies, memory placement, and thread scheduling have every bit as insidious an effect on parallel performance in Haskell as in C.</p>
<p>Parallel programming is a <em>subtle art</em> no matter which language you do it in.</p>
</div>
</body>

<!-- Mirrored from www.scs.stanford.edu/11au-cs240h/notes/par-slides.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 19 Dec 2016 04:55:13 GMT -->
</html>
