<!DOCTYPE html>
<html lang="en-US">


<!-- Mirrored from blog.ezyang.com/2010/06/the-haskell-preprocessor-hierarchy/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 26 Dec 2016 20:34:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <!-- apple-touch-icon? -->
  <meta name=viewport content='width=device-width, initial-scale=1'>
        <title>The Haskell Preprocessor Hierarchy :  Inside 736-131</title>

  <link rel="stylesheet" href="http://blog.ezyang.com/wp-content/themes/Ashley/style.css" type="text/css" media="screen" charset="utf-8" />
  <link href='http://fonts.googleapis.com/css?family=Gentium+Book+Basic' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

  <link rel="alternate" type="application/rss+xml" title="Inside 736-131 RSS Feed" href="http://blog.ezyang.com/feed/" />
  <link rel="alternate" type="application/atom+xml" title="Inside 736-131 Atom Feed" href="http://blog.ezyang.com/feed/atom/" />

  <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?lang=hs"></script>
  <script src="http://blog.ezyang.com/wp-content/lang-coq.js"></script>
  <link rel="pingback" href="http://blog.ezyang.com/xmlrpc.php" />
    <link rel="alternate" type="application/rss+xml" title="Inside 736-131 &raquo; The Haskell Preprocessor Hierarchy Comments Feed" href="feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/blog.ezyang.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.5.2"}};
			!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;if(!g||!g.fillText)return!1;switch(g.textBaseline="top",g.font="600 32px Arial",a){case"flag":return g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3;case"diversity":return g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,d=c[0]+","+c[1]+","+c[2]+","+c[3],g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e;case"simple":return g.fillText(h(55357,56835),0,0),0!==g.getImageData(16,16,1,1).data[0];case"unicode8":return g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<script type='text/javascript' src='http://blog.ezyang.com/wp-includes/js/jquery/jquery.js?ver=1.12.3'></script>
<script type='text/javascript' src='http://blog.ezyang.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.0'></script>
<script type='text/javascript' src='http://blog.ezyang.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9'></script>
<link rel='https://api.w.org/' href='http://blog.ezyang.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.ezyang.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.ezyang.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Static Analysis for everyday (not-PhD) man' href='http://blog.ezyang.com/2010/06/static-analysis-mozilla/' />
<link rel='next' title='Setting up Cabal, the FFI and c2hs' href='http://blog.ezyang.com/2010/06/setting-up-cabal-the-ffi-and-c2hs/' />
<meta name="generator" content="WordPress 4.5.2" />
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='http://blog.ezyang.com/?p=1784' />
<link rel="alternate" type="application/json+oembed" href="http://blog.ezyang.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fblog.ezyang.com%2F2010%2F06%2Fthe-haskell-preprocessor-hierarchy%2F" />
<link rel="alternate" type="text/xml+oembed" href="http://blog.ezyang.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fblog.ezyang.com%2F2010%2F06%2Fthe-haskell-preprocessor-hierarchy%2F&amp;format=xml" />
<style type="text/css">
/* <![CDATA[ */
img.latex { vertical-align: middle; border: none; }
/* ]]> */
</style>
<!-- Google Analytics Tracking by Google Analyticator 6.4.9: http://www.videousermanuals.com/google-analyticator/ -->
<script type="text/javascript">
    var analyticsFileTypes = [''];
    var analyticsSnippet = 'enabled';
    var analyticsEventTracking = 'enabled';
</script>
<script type="text/javascript">
	var _gaq = _gaq || [];
  
	_gaq.push(['_setAccount', 'UA-12247861-1']);
    _gaq.push(['_addDevId', 'i9k95']); // Google Analyticator App ID with Google
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</head>

<body class="single single-post postid-1784 single-format-standard">

<header>
  <h1 class="vcard author"><a href="http://blog.ezyang.com/" title="Home">Inside 736-131</a></h1>
  <p>
    Existential Pontification and Generalized Abstract Digressions    <ul class="pages">
      <li class="page_item page-item-2"><a href="http://blog.ezyang.com/about/">About</a></li>
<li class="page_item page-item-21"><a href="http://blog.ezyang.com/archives/">Archives</a></li>
      <li><a href="http://blog.ezyang.com/feed/">Subscribe</a></li>
    </ul>
  </p>
</header>

<div class="content wrap">
<section class="posts">
      <article class="post">
      <h2>The Haskell Preprocessor Hierarchy</h2>
      <!--<h4 class="vcard author">by <span class="fn">Edward Z. Yang</span></h4>-->
      
<div class="document">


<!-- -*- mode: rst -*- -->
<p>This post is part of what I hope will be a multi-part tutorial/cookbook series on using <a class="reference external" href="http://www.cse.unsw.edu.au/~chak/haskell/c2hs/">c2hs</a> (<a class="reference external" href="http://hackage.haskell.org/cgi-bin/hackage-scripts/package/c2hs">Hackage</a>).</p>
<ol class="arabic simple">
<li>The Haskell Preprocessor Hierarchy (this post)</li>
<li><a class="reference external" href="http://blog.ezyang.com/2010/06/setting-up-cabal-the-ffi-and-c2hs/">Setting up Cabal, the FFI and c2hs</a></li>
<li><a class="reference external" href="http://blog.ezyang.com/2010/06/principles-of-ffi-api-design/">Principles of FFI API design</a></li>
<li><a class="reference external" href="http://blog.ezyang.com/2010/06/first-steps-in-c2hs/">First steps in c2hs</a></li>
<li><a class="reference external" href="http://blog.ezyang.com/2010/06/marshalling-with-get-and-set/">Marshalling with get an set</a></li>
<li><a class="reference external" href="http://blog.ezyang.com/2010/06/call-and-fun-marshalling-redux/">Call and fun: marshalling redux</a></li>
</ol>
<p><em>What's c2hs?</em> c2hs is a Haskell preprocessor to help people generate <a class="reference external" href="http://www.haskell.org/haskellwiki/FFI_Introduction">foreign-function interface</a> bindings, along with <a class="reference external" href="http://www.haskell.org/ghc/docs/6.12.2/html/users_guide/hsc2hs.html">hsc2hs</a> and <a class="reference external" href="http://www.haskell.org/greencard/">GreenCard</a>. The below diagram illustrates how the preprocessors currently supported by Cabal fit together. (For the curious, Cpp is thrown in with the rest of the FFI preprocessors, not because it is particularly useful for generating FFI code, but because many of the FFI preprocessors also implement some set of Cpp's functionality. I decided on an order for Alex and Happy on the grounds that Alex was a lexer generator, while Happy was a parser generator.)</p>
<div class="outer-image"><div class="inner-image"><img alt="/img/hs-preprocessor.png" src="http://blog.ezyang.com/img/hs-preprocessor.png" /></div></div>
<p><em>What does c2hs do?</em> Before I tell you what c2hs does, let me tell you what it does <em>not</em> do: it does <em>not</em> magically eliminate your need to understand the FFI specification. In fact, it will probably let you to write bigger and more ambitious bindings, which in turn will test your knowledge of the FFI. (More on this later.)</p>
<p>What c2hs does help to do is eliminate some of the drudgery involved with writing FFI bindings. (At this point, the veterans who've written FFI bindings by hand are nodding knowingly.) Here are some of the things that you will not have to do anymore:</p>
<ul class="simple">
<li>Port enum definitions into pure Haskell code (this would have meant writing out the data definition as well as the Enum instance),</li>
<li>Manually compute the sizes of structures you are marshalling to and from,</li>
<li>Manually compute the offsets to peek and poke at fields in structures (and deal with the corresponding portability headaches),</li>
<li>Manually write types for C pointers,</li>
<li>(To some extent) writing the actual <tt class="docutils literal">foreign import</tt> declarations for C functions you want to use</li>
</ul>
<p><em>When should I use c2hs?</em> There are many Haskell pre-processors; which one should you use? A short (and somewhat inaccurate) way to characterize the above hierarchy is the further down you go, the <em>less</em> boilerplate you have to write and the <em>more</em> documentation you have to read; I have thus heard advice that hsc2hs is what you should use for small FFI projects, while c2hs is more appropriate for the larger ones.</p>
<p>Things that c2hs supports that hsc2hs does not:</p>
<ul class="simple">
<li>Automatic generation of <tt class="docutils literal">foreign import</tt> based on the contents of the C header file,</li>
<li>Semi-automatic marshalling to and from function calls, and</li>
<li>Translation of pointer types and hierarchies into Haskell types.</li>
</ul>
<p>Things that GreenCard supports and c2hs does not:</p>
<ul class="simple">
<li>Automatic generation of <tt class="docutils literal">foreign import</tt> based on the Haskell type signature (indeed, this is a major philosophical difference),</li>
<li>A more comprehensive marshalling language,</li>
<li>Automatic generation of data marshalling using Data Interface schemes.</li>
</ul>
<p>Additionally, hsc2hs and c2hs are considered quite mature; the former is packaged with GHC, and (a subset of) the latter is used in gtk2hs, arguably the largest FFI binding in Haskell. GreenCard is a little more, well, green, but it recently received a refresh and is looking quite promising.</p>
<p><em>Is this tutorial series for me?</em> Fortunately, I'm not going to assume too much knowledge about the FFI (I certainly didn't have as comprehensive knowledge about it going in than I do coming out); however, some understanding of C will be assumed in the coming tutorials. In particular, you should understand the standard idioms for passing data to and out of C functions and feel comfortable tangling with pointers (though there might be a brief review there too).</p>
<p><em>Next time.</em> <a class="reference external" href="http://blog.ezyang.com/2010/06/setting-up-cabal-the-ffi-and-c2hs/">Setting up Cabal, the FFI and c2hs</a>.</p>
</div>
      <footer>
                <ul class="small">
          <li><abbr class="published" title="2010-06-11T09:00:12-0500"><a href="http://blog.ezyang.com/2010/06/11/">June 11, 2010</a></abbr></li>
          <li><a href="http://blog.ezyang.com/category/haskell/c2hs/" rel="category tag">c2hs</a></li>
        </ul>
              </footer>
    </article>

    <footer id="comments">
      <h3>4 Responses to &#8220;The Haskell Preprocessor Hierarchy&#8221;</h3>
    <ol class="commentlist">
      		<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-528">
				<div id="div-comment-528" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=52&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=104&amp;d=mm&amp;r=g 2x' class='avatar avatar-52 photo' height='52' width='52' />			<cite class="fn"><a href='http://ezyang.com/' rel='external nofollow' class='url'>Edward Z. Yang</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-528">
			June 11, 2010 at 12:50 pm</a>		</div>

		<p>Zao mentioned on #haskell <a href="http://hackage.haskell.org/package/bindings-DSL-1.0.6" rel="nofollow">bindings-DSL</a>, which is a macro language built on top of hsc2hs.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-541">
				<div id="div-comment-541" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/?s=52&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/?s=104&amp;d=mm&amp;r=g 2x' class='avatar avatar-52 photo avatar-default' height='52' width='52' />			<cite class="fn">Gour</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-541">
			June 15, 2010 at 1:12 am</a>		</div>

		<p>Anyone can comment about bindings-DSL/hsc2hs vs. c2hs?</p>
<p>Sincerely,<br />
Gour</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-542">
				<div id="div-comment-542" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=52&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=104&amp;d=mm&amp;r=g 2x' class='avatar avatar-52 photo' height='52' width='52' />			<cite class="fn"><a href='http://ezyang.com/' rel='external nofollow' class='url'>Edward Z. Yang</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-542">
			June 15, 2010 at 1:23 am</a>		</div>

		<p>Having not used bindings-DSL, I cannot comment too strongly on it. A benefit: it appears to be stronger than c2hs, with support for automated Storable generation, for example. A downside: it is built entirely on top of C macros, which in my opinion leave something to be desired.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-544">
				<div id="div-comment-544" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/?s=52&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/?s=104&amp;d=mm&amp;r=g 2x' class='avatar avatar-52 photo avatar-default' height='52' width='52' />			<cite class="fn">Gour</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-544">
			June 15, 2010 at 6:11 am</a>		</div>

		<p>Heh&#8230;it would be nice to have &#8216;one&#8217; tool combining best from both worlds&#8230;</p>

		
				</div>
		</li><!-- #comment-## -->
    </ol>
  
            <form action="http://blog.ezyang.com/wp-comments-post.php" method="post" id="commentform">
        <h3>Leave a Comment</h3>
                  <p>
            <label>Name (Optional): <input type="text" name="author" id="author" value="" /></label>
          </p>
                <label>Comment: <textarea name="comment" id="comment" cols="50" rows="20"></textarea></label>
        <div id="cancel-comment-reply" class="p reply">
          <a rel="nofollow" id="cancel-comment-reply-link" href="index.html#respond" style="display:none;">Cancel Reply</a>        </div>
        <input type="submit" value="Post Comment" /> <input type="hidden" name="comment_post_ID" value="1784" />
        <input type='hidden' name='comment_post_ID' value='1784' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
        <p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="74d86b5def" /></p><p style="display:none;"><input type="text" name="nxts" value="1482784244" /><input type="text" name="nxts_signed" value="8970ba0df832da4dc129ab276f69f36aa8f6325f" /><input type="text" name="604d6fb615e8f492d" value="" /><input type="text" name="b09a595b22b6cf898b9b58fa" value="8439223d7954fa0" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="103"/></p>      </form>
      </footer> <!-- /comments -->

    <div class="pagination p">
      <span class="previous"><a href="http://blog.ezyang.com/2010/06/static-analysis-mozilla/" rel="prev">&laquo; Previous Post</a></span>
      <span class="next"><a href="http://blog.ezyang.com/2010/06/setting-up-cabal-the-ffi-and-c2hs/" rel="next">Next Post &raquo;</a></span>
    </div>
  </div>
</div> <!-- /content -->

<footer class="bottom small wrap">
    <p class="small">&copy; Inside 736-131. Powered by <a href="http://wordpress.org/">WordPress</a>, theme based off of <a href="http://jxnblk.com/ashley/">Ashley</a>.</p>
  </div>
</footer>

<script type='text/javascript' src='http://blog.ezyang.com/wp-content/plugins/akismet/_inc/form.js?ver=3.1.11'></script>
<script type='text/javascript' src='http://blog.ezyang.com/wp-includes/js/comment-reply.min.js?ver=4.5.2'></script>
<script type='text/javascript' src='http://blog.ezyang.com/wp-includes/js/wp-embed.min.js?ver=4.5.2'></script>

</body>

<!-- Mirrored from blog.ezyang.com/2010/06/the-haskell-preprocessor-hierarchy/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 26 Dec 2016 20:34:21 GMT -->
</html>
