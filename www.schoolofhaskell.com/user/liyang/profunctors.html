<!DOCTYPE html>
<html>
<!-- Mirrored from www.schoolofhaskell.com/user/liyang/profunctors by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 23 Dec 2016 08:26:19 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><title>I love profunctors. They&#39;re so easy. - School of Haskell | School of Haskell</title><meta http-equiv="x-ua-compatible" content="IE=9"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="Rfxk2TdeMMXEXHgJ2_OO8Rt3hPbQSDao0OXQV_n6z_s" /><link href="http://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet" type="text/css"><link href="https://www.schoolofhaskell.com/recent-content/feed" type="application/rss+xml" rel="alternate" title="Recently published content">
<link rel="stylesheet" href="https://www.schoolofhaskell.com/static/combined/UlwEHVcM.css"><style>#hident3 .like-count{margin-right:0.5em}#hident3 .likes{font-family:merriweather;float:right;margin-bottom:1em;border:1px solid #eee;font-size:1.1em;padding:0.25em;border-radius:0.25em;display:inline-block;text-align:center;color:#468847;background-color:#dff0d8;border-color:#d6e9c6}#hident3 .likes:hover{text-decoration:none;cursor:pointer}#hident3 .likes-liked i{opacity:0.25}#hident3 .likes-liked .like-count{font-weight:bold }#hident3 .like-not-logged-in *{cursor:default}.social{margin-right:1em}h1{font-family:Merriweather !important}article{font-family:Merriweather !important}article li{font-family:Merriweather !important;line-height:1.6em}h1,h2,h3,h4,h4,h5{font-family:Merriweather !important}.editor p{font-family:Frutiger, "Frutiger Linotype", Univers, Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans Condensed", "Liberation Sans", "Nimbus Sans L", Tahoma, Geneva, "Helvetica Neue", Helvetica, Arial, sans-serif}.article-footer{border-top:1px solid #ddd;padding-top:1em;margin-top:1em}body{font-size:16px !important}.navbar .navbar-inner{background:#3c3f41}.navbar .brand{font-size:14px}.navbar .brand img{width:6em}.navbar .icon-wrench{margin:0 -0.5em 0 -0.5em;padding:0 1em 0 1em;height:20px}.navbar-inverse .nav .active a{background:#333638}.navbar-inverse .nav > li > a{color:#a7a7a7
}.navbar-inverse .btn-navbar{background:#333638}.navbar-inverse .nav > li a:hover,.navbar-inverse .btn{background:#333537 !important}@media (max-width: 979px) {.icon-wrench{padding-left:1em !important}}.breadcrumb{border-top-left-radius:0;border-top-right-radius:0}h1{margin-top:20px}.breadcrumb-container + .main-content h1{margin-top:0}.footer{padding:30px 0;margin-top:70px;border-top:1px solid #e5e5e5;background-color:#f5f5f5}.footer ul.footer-menu{list-style-type:none}.footer ul.footer-menu li{display:inline-block}.footer ul.footer-menu li + li{margin-left:0.5em}.footer ul.footer-menu li + li:before{margin-right:0.5em;content:"Â·";color:#999}.footer ul.menu li{display:inline-block}.footer ul.menu li + li{margin-left:0.5em}.footer .copyright{margin-left:25px}.main-content{min-height:100%}.gravatar{width:80px;height:80px;border-radius:2px;background:#eee}.empty-gravatar{width:0}.container{font-family:"Segoe UI", Candara, "Bitstream Vera Sans", "DejaVu Sans", "Bitstream Vera Sans", "Trebuchet MS", Verdana, "Verdana Ref", sans-serif}.container h1,.container h2,.container h4,.container h4,.container h5{font-family:"Segoe UI", Candara, "Bitstream Vera Sans", "DejaVu Sans", "Bitstream Vera Sans", "Trebuchet MS", Verdana, "Verdana Ref", sans-serif}article{font-family:Merriweather !important}article h1{font-family:Merriweather !important}article li{font-family:Merriweather !important;line-height:1.6em}article li + li{margin-top:0.5em}article div.code{background:#f9f9f9;border:1px solid #d1d1d1;position:relative;border-radius:0.2em;margin:0.25em 0 0.75em 0;min-height:2.5em}article code{color:#005580;font-size:14px;white-space:pre}article a.hoogle > code{color:#0088cc;font-size:14px;white-space:pre;border:0}article .expand-code{display:none}article pre{overflow:auto;word-wrap:normal}article code.active{display:block;max-height:430px}article h1{font-size:31.5px}article h3{font-size:17.5px}article h4{font-size:14px}article h5,article h6{font-size:11.9px}article p{line-height:1.7em}article h1 code,article h2 code,article h3 code,article h4 code,article h5 code,article h6 code{font-size:inherit !important}article h1 a,article h2 a,article h3 a,article h4 a,article h5 a,article h6 a{color:#444}article h1 a:before,article h2 a:before,article h3 a:before,article h4 a:before,article h5 a:before,article h6 a:before{margin-left:-1.5em;padding-right:0.5em;font-family:fontawesome;content:"\f0c1";font-size:20px;color:#fff}article h1 a:hover,article h2 a:hover,article h3 a:hover,article h4 a:hover,article h5 a:hover,article h6 a:hover{text-decoration:none;color:#0088cc}article h1 a:hover:before,article h2 a:hover:before,article h3 a:hover:before,article h4 a:hover:before,article h5 a:hover:before,article h6 a:hover:before{color:#888}article h2{font-size:24.5px}article .popover{font-family:actor}article .popover h3.popover-title{font-family:actor !important;font-size:1em}article .popover .popover-content{width:15em;font-size:1em}article .controlsRun{display:block;padding:0.5em;text-align:right;background:#f2f2f2}article .controlsRun a.clone{margin-right:1em;font-family:actor;text-decoration:none}article .controlsRun a.clone span{padding-left:0.5em}article .controlsRun a.run,article .controlsRun a.reset,article .controlsRun a.show-code{font-size:16px}article .controlsRun a.run span,article .controlsRun a.reset span,article .controlsRun a.show-code span{display:none}article .controlsRun a.reset{margin-left:0.5em;color:#a2becc}article .controlsRun a.reset{display:none}article .controlsRun a.show-code{margin-right:0.75em}article .controlsRun a.run:hover,article .controlsRun a.show-code:hover{text-decoration:none}article .controlsRun a.show-code.active{color:#DC0D0D}article .controlsRun a[disabled]{color:#a2becc;cursor:default}article .collapse-area .collapse-header{background:#0088cc;color:#fff;padding:0.3em;cursor:pointer}article .collapse-area .hidden-toggle:before{content:"\f0d7";font-family:fontawesome;margin-right:0.5em;margin-left:0.25em}article .collapse-area .collapsed-files{overflow:auto;height:auto}article .collapse-area.collapse-disabled{display:none}article .collapse-area.collapse-area-off .collapsed-files{height:0px;overflow:hidden}article .collapse-area.collapse-area-off .hidden-toggle:before{content:"\f0da"}article .snippet-stdio .stdout{margin:0.5em;padding-right:2em;position:relative;word-wrap:break-word}article .snippet-stdio .stdin{-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;-webkit-transition:none;-moz-transition:none;-o-transition:none;transition:none;padding:0;margin:0}article .hoogle-results{margin:0.25em}article .hoogle-results .hoogle-inner{background:#fff;padding:0.5em;border-radius:3px;border:1px solid #ddd}article .hoogle-results .hoogle-inner .close-link{position:relative;float:right;margin-top:-0.5em;margin-right:-0.5em}article .snippet-output-errors{margin:1em 0.5em 0.5em 0.5em;position:relative}article .snippet-output-errors ul{list-style-type:none;margin:0;position:relative}article .snippet-output-errors pre{border:0;border-radius:0;padding:0.25em;margin:0;background:inherit;color:inherit}article .snippet-output-errors .close-link{color:inherit;background:inherit}article .snippet-editors{z-index:0;padding:0.25em}article .close-link{padding:0.5em;background:#eaeaea;border-bottom-left-radius:0.2em;border-top-right-radius:0.2em;position:absolute;top:0;right:0}article .close-link:hover{text-decoration:none}article .snippet-title{padding:0.5em 0 0 0.5em}article .snippet-title .snippet-icon{font-family:FontAwesome;display:inline-block;margin-right:0.5em}article .fullModuleCode + div .snippet-title{margin-top:0.5em;border-top:1px solid #ccc;padding-top:0.5em}article .CodeMirror{height:auto;min-height:1em;line-height:1.5em;background:transparent;font-size:14px !important}article .CodeMirror .highlighted{background:rgba(250, 210, 0, 0.45) !important}article .CodeMirror-widget{margin-left:2em;line-height:1.8}article .CodeMirror.collapsed{height:10em !important}article .editor .expander{text-align:center;display:block;padding:0.5em;text-decoration:none;border-bottom-left-radius:2px;border-bottom-right-radius:2px}article .editor .expander .ellipsis{background:white;border:1px solid #ccc;padding:0 0.5em;height:1em;line-height:0.5em;display:inline-block;color:#555;cursor:pointer}article .editor .expander .ellipsis:hover{background:#ddd;color:#333}article .web-runner{margin:0.5em;padding:0.5em;border:1px solid #ccc;border-radius:3px;background:#f5f5f5}article .web-runner iframe{border:0;margin-top:0.5em;margin-bottom:0;background:white}article .web-runner .controls i{cursor:pointer;color:#0088cc}article .web-runner .controls i:hover{color:#222}article .web-runner .controls i + i{margin-left:0.5em}article .web-runner .controls .icon-remove{float:right}article .hidden{display:block;visibility:visible}article .controlsShowHide{margin-bottom:0.5em}.tutorial-body{float:left !important}.tutorial-nav{float:right !important}@media (max-width: 979px) {.related-content{float:right}.author-name{display:block;margin-left:20px !important;padding-left:5px;margin-top:5px}article h1 a:hover:before,article h2 a:hover:before,article h3 a:hover:before,article h4 a:hover:before,article h5 a:hover:before,article h6 a:hover:before{color:#fff}.tutorial-nav{float:none !important;width:auto !important}.tutorial-body{float:none !important;width:auto !important}}@media (min-width: 980px) and (max-width: 1199px) {.navbar-search{display:none}.tutorial-nav{width:200px}.tutorial-body{width:720px}}#accountPage h1{margin:20px 0 0 0}#accountPage h2{font-size:20px}.group-contents .span8{float:left}.group-contents .span4{float:right}.container > .alert-block{margin-top:1em}.alert{color:#aa874a
}.social{margin-bottom:.8em;display:block}.social a{text-decoration:none}.social i{font-size:1.1em;color:#fff;padding:0.25em;border-radius:0.25em;width:1em;display:inline-block;text-align:center}.social i.icon-twitter{background:#0088cc}.social i.icon-facebook{background:#3b5998
  }.social i.icon-google-plus{background:#dd4b39
  }.well pre{background:#fcfcfc}.well h2{margin-top:0}code{color:#005580;font-size:14px;white-space:pre}</style><!--[if lt IE 8]><link rel="stylesheet" href="https://www.schoolofhaskell.com/static/design/css/ie7.css?etag=TSMl9x1V"><![endif]--><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--></head><body class="not-logged-in" itemscope itemtype="http://schema.org/Product"><noscript><iframe src="http://www.googletagmanager.com/ns.html?id=GTM-H62P" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='http://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-H62P');</script><div class="navbar navbar-inverse navbar-static-top"><div class="navbar-inner"><div class="container"><a class="btn btn-navbar" type="button" data-toggle="collapse" data-target=".nav-collapse"><span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</a>
<a class="brand" href="https://www.schoolofhaskell.com/"><img src="https://www.schoolofhaskell.com/static/img/ide-logo.png" title="School of Haskell">
</a>
<div class="nav-collapse collapse"><ul class="nav"><li><a href="https://www.schoolofhaskell.com/">School</a>
</li>
<li><a href="https://www.schoolofhaskell.com/user">Users</a>
</li>
</ul>
<form class="navbar-search pull-left" action="https://www.schoolofhaskell.com/search"><input class="search-query" type="text" placeholder="Search" name="search">
</form>
<ul class="nav pull-right"><li><a href="https://www.schoolofhaskell.com/auth/login">Login</a>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="container breadcrumb-container"><div class="row"><div class="span12"><ul class="breadcrumb"><li><a href="https://www.schoolofhaskell.com/user/liyang">Liyang HU</a>
<span class="divider">/</span>
</li>
<li><a href="profunctors.html">I love profunctors. They&#39;re so easy.</a>
</li>
</ul>
</div>
</div>
</div>
<div class="container main-content"><div class="row"><div class="span12"><p class="alert">Interactive code snippets not yet available for SoH 2.0, see our <a href=https://www.fpcomplete.com/blog/2016/01/soh-status>Status of
 of School of Haskell 2.0 blog post</a></p>
</div>
</div>
<div class="row"><div class="span12"><h1 itemprop="name">I love profunctors. They&#39;re so easy.</h1>
</div>
</div>
<div class="row"><div class="span7 meta"><p><span class="date">16 Oct 2013</span>
<span class="author"><a href="https://www.schoolofhaskell.com/user/liyang">Liyang HU</a>
</span>
<span class="view-edit-link pull-right"><a class="view-source-link" href="https://www.schoolofhaskell.com/tutorial-raw/5171/bae9e3db2445d2f3475a38e91fdb772efbb2f1bb">View Markdown source</a>
</span>
</p>
<p class="tags"></p>
</div>
</div>
<div class="row"><div class="span7 meta"><div id="hident3"></div>

<span class="sociallinksunicode social">
<a href="https://twitter.com/home?status=$url$" target="_blank"><i class="icon-twitter"></i></a>&nbsp;
<a href="http://www.facebook.com/sharer/sharer.php?u=$url$" target="_blank"><i class="icon-facebook"></i></a>&nbsp;
<a href="https://plus.google.com/share?url=$url$" target="_blank"><i class="icon-google-plus"></i></a></span>
</div>
</div>
<div class="row" itemprop="desc"><div class="span4 tutorial-nav"><div class="related-content"><ul class="nav nav-tabs nav-stacked"><li><script>reddit_target='fpcomplete'</script>
<script src="https://redditstatic.s3.amazonaws.com/button/button1.js"></script>
</li>
<li><a href="https://www.schoolofhaskell.com/user/liyang">See all content by Liyang HU</a>
</li>
</ul>

</div>
<div class="aside"><h3>Sections</h3>
<ul><li><a href="#covariant-functors">Covariant Functors</a></li><li><a href="#contravariant-functors">Contravariant Functors</a><ul><li><a href="#examples-of-contravariant-functors">Examples of Contravariant Functors</a></li></ul></li><li><a href="#bifunctors">Bifunctors</a><ul><li><a href="#exercise--instance-bifunctor-either">Exercise: instance Bifunctor Either</a></li><li><a href="#exercise--instance-bifunctor----">Exercise: instance Bifunctor (,)</a></li></ul></li><li><a href="#profunctors">Profunctors</a><ul><li><a href="#exercise--instance-profunctors----">Exercise: instance Profunctors (â)</a></li><li><a href="#my-first-profunctor">My First Profunctor</a></li><li><a href="#example--containers-with-keys">Example: Containers with Keys</a><ul><li><a href="#exercise--instance-profunctor--indexed-i-">Exercise: instance Profunctor (Indexed i)</a></li><li><a href="#exercise--mapindexable">Exercise: mapIndexable</a></li></ul></li></ul></li><li><a href="#conclusion">Conclusion</a></li><li><a href="#further-reading">Further Reading</a></li></ul></div>
</div>
<div class="span8 tutorial-body" data-environment="ghc-7.8-stable-14.09">
<article><p>â<i>I love profunctors. They're so easy.</i>â âbeaky on <a href="irc://irc.freenode.net/haskell">#haskell</a></p><p><a href="http://www.reddit.com/r/haskell/comments/1bg21c/so_i_accidentally_a_profunctors_tutorial/" title="Reddit comments"><img alt="Reddit" src="https://www.schoolofhaskell.com/content-proxy?src=http%3A%2F%2Freddit.com%2Fstatic%2Fspreddit2.gif" /></a> <a href="https://plus.google.com/100604691747126657305/posts/Q5Wyc6WaVBa" title="G+ thread"><img alt="G+" src="https://www.schoolofhaskell.com/content-proxy?src=http%3A%2F%2Fwww.gstatic.com%2Fimages%2Ficons%2Fgplus-16.png" /></a>
<a href="http://d.hatena.ne.jp/its_out_of_tune/20130407/1365350952"><code>[æ¥æ¬èªç]</code></a></p><h2 id="covariant-functors"><a href="#covariant-functors">Covariant Functors</a></h2><p>I hope we can all agree that functors are useful, and that we are all familiar with them. Just for the record, the <code>Functor</code> typeclass can be thought of as follows:</p><pre><code class="haskell">class Functor f where
    fmap â· (a â b) â f a â f b</code></pre><p>Given a value <code>x â· f a</code> and a function <code>g â· a â b</code>, then <code>fmap g x â· f b</code>. <a href="http://www.youtube.com/watch?v=M0mXUC0cUPg">Simples</a>!</p><p>However, Haskell's <code>Functor</code> is only one of many <i>functors</i> in the mathematical sense. It is in fact a <i>covariant</i> functor, meaning that <code>fmap</code> preserves the direction of the arrows:</p><pre><code class="haskell">Â     g â·   a â   b
fmap g â· f a â f b</code></pre><p>See? Both arrows point to the right.</p><h2 id="contravariant-functors"><a href="#contravariant-functors">Contravariant Functors</a></h2><p>Let's start with a motivational example. We call a function returning a <code>Bool</code> and taking one argument a <a href="http://hackage.haskell.org/packages/archive/contravariant/latest/doc/html/Data-Functor-Contravariant.html#t:Predicate"><code>Predicate</code></a>, indicating the <a href="../../../en.wikipedia.org/wiki/Truthiness">truthiness</a> of its argument:</p><pre><code class="haskell">type Predicate a = a â Bool</code></pre><p>Is <a href="http://hackage.haskell.org/packages/archive/contravariant/latest/doc/html/Data-Functor-Contravariant.html#t:Predicate"><code>Predicate</code></a> a <code>Functor</code>?</p><div class="hidden"><p><img alt="Grumpy Cat says: NO." src="https://www.schoolofhaskell.com/content-proxy?src=https%3A%2F%2Fwww.fpcomplete.com%2Fmedia%2Fd06e3d62-09c1-4261-ab42-c472b9b247b3.jpeg" /></p></div><p>Is <a href="http://hackage.haskell.org/packages/archive/contravariant/latest/doc/html/Data-Functor-Contravariant.html#t:Predicate"><code>Predicate</code></a> a <i>functor</i>?</p><div class="hidden"><p>Let's ask lambdabot:</p><pre><code>&lt;liyang&gt; @faq Is Predicate a functor?
&lt;lambdabot&gt; The answer is: Yes! Haskell can do that.</code></pre></div><p>From <a href="http://hackage.haskell.org/packages/archive/contravariant/latest/doc/html/Data-Functor-Contravariant.html"><code>Data.Functor.Contravariant</code></a>:</p><pre><code class="haskell">class Contravariant f where
    contramap â· (b â a) â f a â f b</code></pre><p>This characterises <i>contravariant</i> functors. Note that <code>contramap</code> swaps the direction of the arrow, in <i>contrast</i> to <code>fmap</code>:</p><pre><code class="haskell">Â          g â·   a â   b
contramap g â· f a â f b</code></pre><p>Let's make a <a href="http://hackage.haskell.org/packages/archive/contravariant/latest/doc/html/Data-Functor-Contravariant.html#t:Contravariant"><code>Contravariant</code></a> <a href="http://hackage.haskell.org/packages/archive/contravariant/latest/doc/html/Data-Functor-Contravariant.html#t:Predicate"><code>Predicate</code></a>:</p><pre><code class="active haskell">{-# LANGUAGE UnicodeSyntax #-}
import Control.Applicative
import Data.Functor.Contravariant (Contravariant (..))
-- show
newtype Predicate a = Predicate { getPredicate â· a â Bool }

instance Contravariant Predicate where
    contramap g (Predicate p) = Predicate (p . g)

veryOdd â· Predicate Integer
veryOdd = contramap (`div` 2) (Predicate odd)

main â· IO ()
main = print $ getPredicate veryOdd &lt;$&gt; [0 .. 11]
-- /show
Â </code></pre><p><a href="http://www.youtube.com/watch?v=EUERRPKA2_w">Can you tell what the output is yet?</a></p><h3 id="examples-of-contravariant-functors"><a href="#examples-of-contravariant-functors">Examples of Contravariant Functors</a></h3><pre><code class="active haskell">{-# LANGUAGE UnicodeSyntax #-}
import Data.Function
import Data.Functor.Contravariant (Contravariant (..))
-- show
newtype Const a b = Const a
instance Contravariant (Const a) where
    contramap _ (Const a) = Const a

newtype Comparison a = Comparison (a â a â Ordering) -- e.g. compare
instance Contravariant Comparison where
    contramap g (Comparison comp) = Comparison (comp `on` g)

newtype Op b a = Op (a â b)
instance Contravariant (Op b) where
    contramap g (Op f) = Op (f . g)
-- /show
main = return ()</code></pre><p>The above (and more) are already provided by <a href="http://hackage.haskell.org/packages/archive/contravariant/latest/doc/html/Data-Functor-Contravariant.html"><code>Data.Functor.Contravariant</code></a>.</p><h2 id="bifunctors"><a href="#bifunctors">Bifunctors</a></h2><p>A bifunctor in the mathematical sense is a functor of two arguments; three arguments would make trifunctorsâ¦</p><div class="hidden"><p>followed by quadri-, quinque-, sexa-, and septi-functor. A multifunctor is fine too.</p></div><p>In Haskell this means a parametric type of kind <code>* â * â *</code>. Familiar bifunctors include <code>Either</code>, <code>(,)</code> or even <code>(â)</code>â¦</p><p>However, the <a href="http://hackage.haskell.org/packages/archive/bifunctors/3.2.0.1/doc/html/Data-Bifunctor.html#t:Bifunctor"><code>Bifunctor</code></a> typeclass correspond only to bifunctors that are <i>covariant in both arguments</i>:</p><pre><code class="haskell">class Bifunctor f where
    bimap â· (a â c) â (b â d) â f a b â f c d</code></pre><pre><code class="haskell">Â      g   â·   a    â   c
        h â·     b  â     d
bimap g h â· f a b  â f c d</code></pre><p>Both <code>Either</code> and <code>(,)</code> are <a href="http://hackage.haskell.org/packages/archive/bifunctors/3.2.0.1/doc/html/Data-Bifunctor.html#t:Bifunctor"><code>Bifunctor</code></a>s. There are also <a href="http://hackage.haskell.org/packages/archive/bifunctors/3.2.0.1/doc/html/Data-Biapplicative.html#t:Biapplicative"><code>Biapplicative</code></a>, <a href="http://hackage.haskell.org/packages/archive/bifunctors/3.2.0.1/doc/html/Data-Bifoldable.html#t:Bifoldable"><code>Bifoldable</code></a> and <a href="http://hackage.haskell.org/packages/archive/bifunctors/3.2.0.1/doc/html/Data-Bitraversable.html#t:Bitraversable"><code>Bitraversable</code></a> classes, if you feel inclined to investigate. <a href="http://www.youtube.com/watch?v=OMAIsqvTh7g">Watch out</a> for <a href="http://hackage.haskell.org/packages/archive/bifunctors/3.2.0.1/doc/html/Data-Bifunctor-Clown.html#t:Clown"><code>Clown</code></a>s and <a href="http://hackage.haskell.org/packages/archive/bifunctors/3.2.0.1/doc/html/Data-Bifunctor-Joker.html#t:Joker"><code>Joker</code></a>s <a href="http://strictlypositive.org/CJ.pdf">popling</a> out around the corner though.</p><h3 id="exercise--instance-bifunctor-either"><a href="#exercise--instance-bifunctor-either">Exercise: <code>instance Bifunctor Either</code></a></h3><div class="hidden"><pre><code class="active haskell">{-# LANGUAGE UnicodeSyntax #-}
class Bifunctor f where
    bimap â· (a â c) â (b â d) â f a b â f c d
-- show
instance Bifunctor Either where
    bimap g h = either (Left . g) (Right . h)
-- /show
main = return ()</code></pre></div><h3 id="exercise--instance-bifunctor----"><a href="#exercise--instance-bifunctor----">Exercise: <code>instance Bifunctor (,)</code></a></h3><div class="hidden"><pre><code class="active haskell">{-# LANGUAGE UnicodeSyntax #-}
import Control.Arrow
class Bifunctor f where
    bimap â· (a â c) â (b â d) â f a b â f c d
-- show
instance Bifunctor (,) where
    bimap = (***)
-- /show
main = return ()</code></pre></div><h2 id="profunctors"><a href="#profunctors">Profunctors</a></h2><p>A <a href="http://hackage.haskell.org/packages/archive/profunctors/3.3.0.1/doc/html/Data-Profunctor.html#t:Profunctor"><code>Profunctor</code></a> is <a href="http://james-iry.blogspot.jp/2009/05/brief-incomplete-and-mostly-wrong.html">just</a> a bifunctor that is contravariant in the first argument and covariant in the second. <a href="http://www.quickmeme.com/meme/3r455v/">What's the problem</a>?</p><pre><code class="haskell">class Profunctor f where
    dimap â· (c â a) â (b â d) â f a b â f c d</code></pre><pre><code class="haskell">Â      g   â·   a    â   c
        h â·     b  â     d
dimap g h â· f a b  â f c d</code></pre><p>If we only want to map over one of the two type arguments, there are:</p><pre><code class="active haskell">{-# LANGUAGE UnicodeSyntax #-}
import Data.Profunctor (Profunctor (dimap))
-- show
lmap â· Profunctor f â (c â a) â f a b â f c b
lmap = (`dimap` id)

rmap â· Profunctor f â (b â d) â f a b â f a d
rmap = (id `dimap`)
-- /show
main = return ()</code></pre><p>The simplest and most common <a href="http://hackage.haskell.org/packages/archive/profunctors/3.3.0.1/doc/html/Data-Profunctor.html#t:Profunctor"><code>Profunctor</code></a> is <code>(â)</code>. The specialised type of <code>dimap</code> would be:</p><pre><code class="haskell">dimap :: (c â a) â (b â d) â (a â b) â (c â d)</code></pre><h3 id="exercise--instance-profunctors----"><a href="#exercise--instance-profunctors----">Exercise: <code>instance Profunctors (â)</code></a></h3><div class="hidden"><pre><code class="active haskell">{-# LANGUAGE UnicodeSyntax #-}
class Profunctor f where
    dimap â· (c â a) â (b â d) â f a b â f c d
-- show
instance Profunctor (â) where dimap g h f = h . f . g
-- /show
main = return ()</code></pre></div><h3 id="my-first-profunctor"><a href="#my-first-profunctor">My First Profunctor</a></h3><p><a href="http://xkcd.com/1015/"><img alt="If you really hate someone, teach them to recognise Profunctors." src="https://www.schoolofhaskell.com/content-proxy?src=https%3A%2F%2Fwww.fpcomplete.com%2Fmedia%2F69c95475-5e55-4573-b213-c1e78fb81219.png" /></a></p><p>This is where I recognised my first <code>Profunctor</code>:</p><pre><code class="haskell">data Limits a = Limits
    { step â· a â (a, a)
    , check â· a â a â Bool } </code></pre><p>This was part of the user-facing code we used in production that lets the user adjust various parameters: she can either click an up/down buttonâor supply a new value directly. The <code>check</code> function then validates the new input with respect to the old.</p><p>If we generalise over the positive and negative argument positions,</p><pre><code class="active haskell">{-# LANGUAGE RecordWildCards #-}
{-# LANGUAGE UnicodeSyntax #-}
import Control.Arrow
import Data.Function
import Data.Profunctor
-- show
type Limits a = Limits' a a
data Limits' a b = Limits
    { step â· a â (b, b)
    , check â· a â a â Bool } 

instance Profunctor Limits' where
    dimap g h Limits {..} = Limits
        { step = (h *** h) . step . g
        , check = check `on` g }

maybeLimit â· a â Limits a â Limits (Maybe a)
maybeLimit d = dimap (maybe d id) Just

millionsLimit â· Limits Double â Limits Double
millionsLimit = dimap (1.0e6 *) (/ 1.0e6)
-- /show
main = return ()</code></pre><h3 id="example--containers-with-keys"><a href="#example--containers-with-keys">Example: Containers with Keys</a></h3><p>Consider the <a href="https://www.fpcomplete.com/hoogle?q=WithKey">plethora of *WithKey functions</a> one comes across when working with various containers, for example:</p><pre><code class="haskell">Map.map        â·     (a â b) â Map i a â Map i b
Map.mapWithKey â· (i â a â b) â Map i a â Map i b</code></pre><p>Can we unify the two functions above?</p><pre><code>&lt;lambdabot&gt; The answer is: Yes! Profunctors can do that.</code></pre><p>The <a href="http://hackage.haskell.org/packages/archive/lens/latest/doc/html/Control-Lens-Indexed.html"><code>Control.Lens.Indexed</code></a> module provides the <a href="http://hackage.haskell.org/packages/archive/lens/latest/doc/html/Control-Lens-Indexed.html#t:Indexed"><code>Indexed</code></a> <a href="http://hackage.haskell.org/packages/archive/profunctors/3.3.0.1/doc/html/Data-Profunctor.html#t:Profunctor"><code>Profunctor</code></a>:</p><pre><code class="haskell">newtype Indexed i a b = Indexed { runIndexed â· i â a â b }</code></pre><h4 id="exercise--instance-profunctor--indexed-i-"><a href="#exercise--instance-profunctor--indexed-i-">Exercise: <code>instance Profunctor (Indexed i)</code></a></h4><div class="hidden"><pre><code class="active haskell">{-# LANGUAGE UnicodeSyntax #-}
import Data.Profunctor

newtype Indexed i a b = Indexed { runIndexed â· i â a â b }
-- show
instance Profunctor (Indexed i) where
    dimap g h (Indexed f) = Indexed (dimap g h . f)
-- /show
main = return ()</code></pre></div><p>Together with the <a href="http://hackage.haskell.org/packages/archive/lens/latest/doc/html/Control-Lens-Indexed.html#t:Indexable"><code>Indexable</code></a> class,</p><pre><code class="active haskell">{-# LANGUAGE MultiParamTypeClasses #-}
{-# LANGUAGE FlexibleInstances #-}
{-# LANGUAGE UnicodeSyntax #-}

newtype Indexed i a b = Indexed { runIndexed â· i â a â b }
-- show
class Indexable i p where
    indexed â· p a b â i â a â b

instance Indexable i (Indexed i) where indexed = runIndexed
instance Indexable i (â)         where indexed = const
-- /show
main = return ()</code></pre><p>we can now give a unified story for <code>Map.map</code> and <code>Map.mapWithKey</code>:</p><pre><code class="haskell">mapIndexable â· Indexable i p â p a b â Map i a â Map i b
mapIndexable â·         Indexed i a b â Map i a â Map i b
mapIndexable â·               (a â b) â Map i a â Map i b</code></pre><h4 id="exercise--mapindexable"><a href="#exercise--mapindexable">Exercise: <code>mapIndexable</code></a></h4><div class="hidden"><pre><code class="active haskell">{-# LANGUAGE UnicodeSyntax #-}
import Control.Lens.Indexed
import Data.Map as Map

mapIndexable â· Indexable i p â p a b â Map i a â Map i b
-- show
mapIndexable = Map.mapWithKey . indexed
-- /show
main = return ()</code></pre></div><h2 id="conclusion"><a href="#conclusion">Conclusion</a></h2><p><img alt="Profunctors, Profunctors everywhere." src="https://www.schoolofhaskell.com/content-proxy?src=https%3A%2F%2Fwww.fpcomplete.com%2Fmedia%2F46542da6-1707-43a9-a0f1-a283ab7f592b.jpeg" /></p><p>The <a href="http://hackage.haskell.org/packages/archive/profunctors/3.3.0.1/doc/html/Data-Profunctor.html#t:UpStar"><code>UpStar</code></a> and <a href="http://hackage.haskell.org/packages/archive/profunctors/3.3.0.1/doc/html/Data-Profunctor.html#t:DownStar"><code>DownStar</code></a> <a href="http://hackage.haskell.org/packages/archive/profunctors/3.3.0.1/doc/html/Data-Profunctor.html#t:Profunctor"><code>Profunctor</code></a>s are also worth investigating, as are the concepts of <a href="http://hackage.haskell.org/packages/archive/profunctors/3.3.0.1/doc/html/Data-Profunctor.html#t:Strong"><code>Strong</code></a> and <a href="http://hackage.haskell.org/packages/archive/profunctors/3.3.0.1/doc/html/Data-Profunctor.html#t:Choice"><code>Choice</code></a>. Homework for the readerâ¦ or let me know if you want me to extend this tutorial. :) Other comments are welcome too &amp;c. &amp;c. 
<a href="http://www.reddit.com/r/haskell/comments/1bg21c/so_i_accidentally_a_profunctors_tutorial/" title="Reddit comments"><img alt="Reddit" src="https://www.schoolofhaskell.com/content-proxy?src=http%3A%2F%2Freddit.com%2Fstatic%2Fspreddit2.gif" /></a> <a href="https://plus.google.com/100604691747126657305/posts/Q5Wyc6WaVBa" title="G+ thread"><img alt="G+" src="https://www.schoolofhaskell.com/content-proxy?src=http%3A%2F%2Fwww.gstatic.com%2Fimages%2Ficons%2Fgplus-16.png" /></a></p><h2 id="further-reading"><a href="#further-reading">Further Reading</a></h2><ul><li><a href="http://stackoverflow.com/a/15235409">How to abstract over a âback and forthâ transformation?</a></li><li><a href="../../../blog.sigfpe.com/2011/07/profunctors-in-haskell.html">Profunctors in Haskell</a>
(Warning: <a href="../../../en.wikipedia.org/wiki/Abstract_nonsense">abstract nonsense</a>)</li><li><a href="../../../en.wikipedia.org/wiki/Functor">Functor</a> on Wikipedia with sections on <a href="../../../en.wikipedia.org/wiki/Functor#Bifunctors_and_multifunctors">bifunctors</a> and <a href="../../../en.wikipedia.org/wiki/Functor#Covariance_and_contravariance" title="In contrast to the OO-normative article labelled âcomputer scienceâ.">covariance versus contravariance</a></li><li><a href="../../../en.wikipedia.org/wiki/Profunctor">Profunctor</a> on Wikipedia</li></ul></article>


</div>
</div>
<div class="row article-footer"><div class="span7 meta"><span class="sociallinksunicode social">
<a href="https://twitter.com/home?status=$url$" target="_blank"><i class="icon-twitter"></i></a>&nbsp;
<a href="http://www.facebook.com/sharer/sharer.php?u=$url$" target="_blank"><i class="icon-facebook"></i></a>&nbsp;
<a href="https://plus.google.com/share?url=$url$" target="_blank"><i class="icon-google-plus"></i></a></span>
</div>
</div>
</div>
<div class="footer"><div class="container"><div class="row"><div class="span12"><ul class="menu"><li><a href="https://www.schoolofhaskell.com/">School</a>
</li>
<li><a href="https://www.schoolofhaskell.com/user">Users</a>
</li>
<li><a href="https://www.schoolofhaskell.com/auth/login">Log In</a>
</li>
<li><a href="https://www.schoolofhaskell.com/auth/page/email/register">Sign Up</a>
</li>
</ul>
</div>
</div>
<div class="row"><div class="span12"></div>
</div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://www.schoolofhaskell.com/static/bootstrap/css/bootstrap-responsive.css" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script><script src="https://www.schoolofhaskell.com/static/combined/cKRLBd-P.js"></script><script>window.fpco = window.fpco || {};
window.fpco.keyMap = "";

        function hident2() {
            if (navigator.id) {
                navigator.id.watch({
                    onlogin: function (assertion) {
                        if (assertion) {
                            document.location = "https://www.schoolofhaskell.com/auth/page/browserid/" + assertion;
                        }
                    },
                    onlogout: function () {}
                });
                navigator.id.request({
                    returnTo: "/auth/login" + "?autologin=true"
                });
            }
            else {
                alert("Loading, please try again");
            }
        }
    
        (function(){
            var bid = document.createElement("script");
            bid.async = true;
            bid.src = "https://login.persona.org/include.js";
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(bid, s);
        })();
    $(function(){
    var url = "https://www.schoolofhaskell.com/like-content/533";
    var $self = $("#hident3");
    $.getJSON(url, function(state){
        var $a, $likeCount;

        $a = $('<a class="likes" href="/auth/login"></a>');
        $likeCount = $('<span class="like-count"></span>');
        $thumbs = $("<i class='icon-thumbs-up' title='Unlike this :-('>");
        $a.append($likeCount);
        $a.append($thumbs);
        $self.append($a);

        updateView();

        $a.click(function(){
            if(state.myLike == 'not-logged-in') {
                return true;
            } else {
                var $a = $(this);
                $.post(url, state.myLike !== 'no-like' ? {unlike:true} : {}, function(data){
                    state.myLike = state.myLike == 'no-like'? 'like' : 'no-like';
                    state.likes = data.likes;
                    updateView();
                });
                return false;
            }
        });

        function updateView(){
            var liked = state.myLike !== 'not-logged-in' && state.myLike !== 'no-like';
            if(liked) $a.addClass('likes-liked');
            else $a.removeClass('likes-liked');

            $likeCount.text(state.likes);

            if(state.myLike !== 'not-logged-in') {
                if (liked) $thumbs.attr('title','Unlike this');
                else $thumbs.attr('title','Like this!');

                if (liked) $a.addClass('likes-liked');
                else $a.removeClass('likes-liked');
            } else {
                $a.addClass('like-not-logged-in');
                $thumbs.attr('title','Please login to vote!');
            }
        }
    });
});
$(function(){
  $("a.logout").click(function(){
    var form = $("<form method='post'/>");
    form.attr("action", $(this).attr("href"));
    $("body").append(form);
    form.submit();
    return false;
  });
});

$(function(){
    $('.sociallinksunicode a').each(function(){
        $(this).attr('href',$(this).attr('href').replace('$url$',document.location));
    });
});

$(function(){
  // If we need to select a user/select a password then show the
  // details confirmation form, otherwise enable the getting started
  // section.
  if($('.alert-block a').text().match(/(selected a username|change your password)/)) {
    $("#confirm-details").show();
    $("#confirm-details #inputUsername").focus();
  } else {
    $("#get-started").removeClass('disabled').addClass('enabled');
  }

  // For lack of a plain HTML validation story this will do.
  $('.welcome-page').each(function(){
    $('form').submit(check);
  });
  function check(){
    setTimeout(check,500);
    var error = false;
    $('.error').removeClass('error');
    $('#enter-details input').each(function(){
      if($(this).val() == '') {
        $(this).parent().parent().addClass('error');
        error = true;
      }
    });
    if(error) return false;
    if($('[name=password]').val() == $('[name=confirm]').val()) {
      $('#confirm').removeClass('error');
      return true;
    } else {
      $('#confirm').addClass('error');
      return false;
    }
  }
});

$(function(){
  // When scrolling over a snippet editor, activate the "clone in IDE" popovers
  $('article').each(function(){
    var n = 100;
    var wait = 10000;
    function check(){
      if($('.clone').length == 0) {
        setTimeout(check,n);
        return;
      }
      var activated = $.cookie('clone-popover');
      if (activated) return;
      var activate = false;
      $('.controlsRun:onScreen').each(function(){
        $.cookie('clone-popover', 'true', { expires: 30, path: '/' });
        activate = true;
        return false;
      });
      if(activate) {
          $('.clone').each(function(){
              // The bootstrap API is rather unreasonable to say the
              // least.
              next = $(this).parent();
              var title = next.attr('title');
              next.attr('data-content',$(this).attr('data-content'));
              next.attr('title',$(this).attr('title'));
              next.popover('show',{
                  title: $(this).attr('title')
              });
              next.attr('title',title);
          });
          setTimeout(function(){
              $('.clone').each(function(){
                  $(this).parent().popover('hide');
              });
          },wait);
      } else {
        setTimeout(check,n);
      }
    }
    setTimeout(check,n);
  });
});

// onScreen jQuery plugin v0.2.1
// (c) 2011-2013 Ben Pickles
//
// http://benpickles.github.com/onScreen
//
// Released under MIT license.
(function(a){a.expr[":"].onScreen=function(b){var c=a(window),d=c.scrollTop(),e=c.height(),f=d+e,g=a(b),h=g.offset().top,i=g.height(),j=h+i;return h>=d&&h<f||j>d&&j<=f||i>e&&h<=d&&j>=f}})(jQuery);

/*!
 * jQuery Cookie Plugin v1.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function($, document) {

  var pluses = /\+/g;
  function raw(s) {
    return s;
  }
  function decoded(s) {
    return decodeURIComponent(s.replace(pluses, ' '));
  }

  $.cookie = function(key, value, options) {

    // key and at least value given, set cookie...
    if (arguments.length > 1 && (!/Object/.test(Object.prototype.toString.call(value)) || value == null)) {
      options = $.extend({}, $.cookie.defaults, options);

      if (value == null) {
	options.expires = -1;
      }

      if (typeof options.expires === 'number') {
	var days = options.expires, t = options.expires = new Date();
	t.setDate(t.getDate() + days);
      }

      value = String(value);

      return (document.cookie = [
	encodeURIComponent(key), '=', options.raw ? value : encodeURIComponent(value),
	options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
	options.path    ? '; path=' + options.path : '',
	options.domain  ? '; domain=' + options.domain : '',
	options.secure  ? '; secure' : ''
      ].join(''));
    }

    // key and possibly options given, get cookie...
    options = value || $.cookie.defaults || {};
    var decode = options.raw ? raw : decoded;
    var cookies = document.cookie.split('; ');
    for (var i = 0, parts; (parts = cookies[i] && cookies[i].split('=')); i++) {
      if (decode(parts.shift()) === key) {
	return decode(parts.join('='));
      }
    }
    return null;
  };
  $.cookie.defaults = {};})(jQuery, document);
</script><!--[if lt IE 10]><script src="https://www.schoolofhaskell.com/static/design/js/ie.js?etag=ayV2DuJ0"></script><![endif]--><script>if(!window.location.href.match(/localhost/)){var track = '/tutorial/user/liyang/profunctors';
window._gaq = [['_setAccount','UA-36928035-1'],track != ''? ['_trackPageview',track] : ['_trackPageview']
,['_trackPageLoadTime']];window._gaq.push(['_setCustomVar',1,'Section','School of Haskell',3]);
window._gaq.push(['_setCustomVar',2,'User Type','Visitor',1]);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);

})();}</script>
<!-- Prompt IE 6 users to install Chrome Frame. Remove this if you want to support IE 6.  chromium.org/developers/how-tos/chrome-frame-getting-started --><!--[if lt IE 7 ]><script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script><script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script><![endif]--></body>
<!-- Mirrored from www.schoolofhaskell.com/user/liyang/profunctors by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 23 Dec 2016 08:26:19 GMT -->
</html>